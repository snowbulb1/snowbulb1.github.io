<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brainrot Collector | Ultimate Edition</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Montserrat:wght@300;400;600&family=Pacifico&family=Comic+Neue:wght@700&display=swap" rel="stylesheet">
    <style>
        :root {
            --strawberry-red: #ff2a6d;
            --leaf-green: #39ff14;
            --brainrot-blue: #05d9e8;
            --milk-pink: #ffb7c5;
            --void-black: #0d0208;
            --gold: #FFD700;
            --velvet: #8b0000;
            --crystal-purple: #a855f7;
        }
        
        body {
            font-family: 'Montserrat', sans-serif;
            background-color: var(--void-black);
            color: #ffffff;
            overflow-x: hidden;
            background-image: url('https://www.transparenttextures.com/patterns/noise-lines.png');
            transition: filter 0.3s ease;
        }

        /* ADMIN PANEL STYLES */
        .admin-panel {
            position: fixed;
            right: 1rem;
            bottom: 5rem;
            width: 280px;
            background: rgba(13, 2, 8, 0.95);
            border: 2px solid #ff2a6d;
            border-radius: 1rem;
            padding: 1rem;
            z-index: 500;
            box-shadow: 0 0 30px rgba(255, 42, 109, 0.4);
            display: none;
            backdrop-filter: blur(10px);
        }
        .admin-panel.active { display: block; animation: panel-slide 0.3s ease-out; }
        @keyframes panel-slide { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        .admin-btn {
            width: 100%;
            padding: 6px;
            margin-bottom: 5px;
            font-size: 10px;
            font-weight: 900;
            text-transform: uppercase;
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 4px;
            background: rgba(255,255,255,0.05);
            transition: all 0.2s;
            color: #fff;
            text-align: left;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .admin-btn:hover { background: rgba(255,255,255,0.15); border-color: #fff; }
        .admin-btn i { width: 14px; height: 14px; }

        /* GLITCH MODE EFFECT */
        body.glitch-mode-active {
            animation: global-glitch 0.2s infinite;
        }
        @keyframes global-glitch {
            0% { filter: hue-rotate(0deg) contrast(1.2); transform: translate(0); }
            20% { transform: translate(-2px, 2px); }
            40% { filter: hue-rotate(90deg); transform: translate(2px, -2px); }
            60% { filter: hue-rotate(180deg); transform: translate(-1px, -1px); }
            80% { filter: hue-rotate(270deg); transform: translate(1px, 1px); }
            100% { filter: hue-rotate(360deg); transform: translate(0); }
        }

        /* FONTS */
        .brand-font { font-family: 'Orbitron', sans-serif; }
        .wild-font { font-family: 'Comic Neue', cursive; }
        .girly-font { font-family: 'Pacifico', cursive; }

        /* NAV BUTTONS */
        .nav-btn {
            position: relative;
            padding: 8px 20px;
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            font-size: 11px;
            color: #fff;
            text-transform: uppercase;
            letter-spacing: 2px;
            border: 1px solid rgba(255,255,255,0.1);
            background: rgba(20, 20, 20, 0.8);
            overflow: hidden;
            transition: all 0.3s ease;
            cursor: pointer;
            clip-path: polygon(10% 0, 100% 0, 100% 70%, 90% 100%, 0 100%, 0 30%);
        }
        .nav-btn:hover {
            background: #ff2a6d;
            color: #000;
            box-shadow: 0 0 15px #ff2a6d, inset 0 0 10px rgba(0,0,0,0.5);
            border-color: #ff2a6d;
            transform: translateY(-2px);
        }
        .nav-btn.blue:hover {
            background: #05d9e8;
            box-shadow: 0 0 15px #05d9e8, inset 0 0 10px rgba(0,0,0,0.5);
            border-color: #05d9e8;
        }
        .nav-btn.green:hover {
            background: #39ff14;
            box-shadow: 0 0 15px #39ff14, inset 0 0 10px rgba(0,0,0,0.5);
            border-color: #39ff14;
        }
        .nav-btn.yellow:hover {
            background: #FFD700;
            box-shadow: 0 0 15px #FFD700, inset 0 0 10px rgba(0,0,0,0.5);
            border-color: #FFD700;
        }

        /* ANIMATIONS & EFFECTS */
        @keyframes rainbow-text { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-20px); } }
        .animate-float { animation: float 6s ease-in-out infinite; }
        .shake-anim { animation: shake 0.5s infinite; }
        @keyframes shake { 0% { transform: translate(1px, 1px) rotate(0deg); } 100% { transform: translate(-1px, -2px) rotate(-1deg); } }
        @keyframes pop { 0% { transform: scale(0); } 80% { transform: scale(1.2); } 100% { transform: scale(1); } }
        @keyframes marquee { 0% { transform: translateX(0); } 100% { transform: translateX(-100%); } }
        
        .rainbow-border-box {
            border: 4px solid transparent;
            background-image: linear-gradient(#111, #111), linear-gradient(to right, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #4b0082, #9400d3);
            background-origin: border-box; background-clip: content-box, border-box;
        }

        /* POWER CRYSTAL MAX GLOW */
        @keyframes crystal-pulse {
            0% { filter: drop-shadow(0 0 2px #a855f7) brightness(1); transform: scale(1); }
            50% { filter: drop-shadow(0 0 15px #d8b4fe) brightness(1.4); transform: scale(1.05); }
            100% { filter: drop-shadow(0 0 2px #a855f7) brightness(1); transform: scale(1); }
        }
        .crystal-max-glow {
            animation: crystal-pulse 1.5s infinite ease-in-out;
            color: #fff !important;
            text-shadow: 0 0 12px rgba(168, 85, 247, 0.8), 0 0 5px white;
        }

        /* BROADCAST NOTIFICATION */
        @keyframes broadcast-slide {
            0% { transform: translateY(-100%); opacity: 0; }
            10% { transform: translateY(0); opacity: 1; }
            90% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(-100%); opacity: 0; }
        }
        .broadcast-msg {
            animation: broadcast-slide 4s ease-in-out forwards;
        }

        /* GAMBLING / RAINBOW BUTTON EFFECT */
        @keyframes rainbow-bg { 
            0% { background-position: 0% 50%; } 
            50% { background-position: 100% 50%; } 
            100% { background-position: 0% 50%; } 
        }
        
        .gamble-effect {
            background: linear-gradient(45deg, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #4b0082, #9400d3);
            background-size: 300% 300%;
            animation: rainbow-bg 3s ease infinite;
            border: 2px solid #FFD700 !important;
            box-shadow: 0 0 15px #FFD700, inset 0 0 10px rgba(0,0,0,0.5) !important;
            color: #fff !important;
            text-shadow: 1px 1px 2px black !important;
            position: relative;
            overflow: visible !important;
        }
        
        .gamble-effect:hover {
            box-shadow: 0 0 25px #FFD700, inset 0 0 20px rgba(255,255,255,0.4) !important;
            transform: scale(1.05) translateY(-2px);
        }

        .gamble-effect::before, .gamble-effect::after {
            content: '‚ú®';
            position: absolute;
            font-size: 12px;
            animation: pulse 0.5s infinite alternate;
            z-index: 30;
        }
        .gamble-effect::before { top: -5px; left: -5px; }
        .gamble-effect::after { bottom: -5px; right: -5px; animation-delay: 0.25s; }

        /* COLLECTION ITEMS */
        .collection-box { transition: all 0.3s; position: relative; }
        .collection-box.locked { filter: grayscale(100%) brightness(50%); opacity: 0.7; }
        .collection-box.unlocked { filter: grayscale(0%); opacity: 1; transform: scale(1); }
        .collection-box:hover { transform: scale(1.1); z-index: 20; }
        
        /* INVENTORY SLOTS */
        .inv-slot { transition: all 0.2s; cursor: pointer; }
        .inv-slot:active { transform: scale(0.95); }
        .inv-slot.empty { opacity: 0.3; cursor: default; filter: grayscale(1); }
        .inv-slot.active { box-shadow: 0 0 15px white; transform: scale(1.1); }
        
        /* SPECIAL INVENTORY SLOTS */
        .special-slot {
            width: 100%; height: 60px;
            background: #111; border: 2px solid #333;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.5rem; border-radius: 0.5rem;
            cursor: pointer; transition: all 0.2s;
            position: relative; overflow: visible;
        }
        .special-slot.active {
            border-color: #ff2a6d;
            box-shadow: 0 0 10px #ff2a6d;
        }
        .special-slot.empty {
            opacity: 0.5; filter: grayscale(1); cursor: default;
        }
        .slot-badge {
            position: absolute; top: -5px; right: -5px;
            background: red; color: white; border-radius: 50%;
            width: 20px; height: 20px; font-size: 10px;
            display: flex; align-items: center; justify-content: center;
            font-weight: bold; border: 1px solid white;
        }

        /* BUY BUTTONS */
        .buy-btn {
            padding: 4px 8px;
            font-size: 10px;
            font-weight: bold;
            text-transform: uppercase;
            border-radius: 4px;
            transition: transform 0.1s, background-color 0.2s;
            width: 100%;
            margin-bottom: 4px;
            cursor: pointer;
        }
        .buy-btn:hover { transform: scale(1.05); }
        .buy-btn:active { transform: scale(0.95); }

        /* ITEM GLOW */
        .item-glow-celebration {
            animation: pulse-glow-rainbow 2s infinite;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
            border: 2px solid white !important;
        }
        @keyframes pulse-glow-rainbow {
            0% { box-shadow: 0 0 10px #ff0000; } 50% { box-shadow: 0 0 20px #ffff00; } 100% { box-shadow: 0 0 10px #ff0000; }
        }
        
        /* GLITCH EFFECT */
        .glitch-text { position: relative; }
        .glitch-text::before, .glitch-text::after {
            content: attr(data-text);
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: transparent;
        }
        .glitch-text::before {
            left: 3px; text-shadow: -2px 0 var(--leaf-green);
            clip: rect(24px, 550px, 90px, 0);
            animation: glitch-anim-2 3s infinite linear alternate-reverse;
        }
        .glitch-text::after {
            left: -3px; text-shadow: -2px 0 var(--brainrot-blue);
            clip: rect(85px, 550px, 140px, 0);
            animation: glitch-anim-2 2.5s infinite linear alternate-reverse;
        }
        @keyframes glitch-anim-2 {
            0% { clip: rect(65px, 9999px, 100px, 0); } 20% { clip: rect(2px, 9999px, 35px, 0); }
            40% { clip: rect(44px, 9999px, 8px, 0); } 60% { clip: rect(71px, 9999px, 29px, 0); }
            80% { clip: rect(9px, 9999px, 55px, 0); } 100% { clip: rect(100px, 9999px, 12px, 0); }
        }

        /* MAILCHIMP OVERRIDES */
        #mc_embed_signup { background: transparent !important; color: white; width: 100% !important; }
        #mc_embed_signup input.email { background-color: #000 !important; border: 2px solid #ff2a6d !important; color: #fff !important; padding: 15px !important; }
        #mc_embed_signup input.button { background: linear-gradient(90deg, #ff2a6d, #05d9e8, #39ff14) !important; color: #000 !important; border: none !important; font-weight: 900 !important; height: 50px !important; cursor: pointer; }

        /* MODAL */
        #lore-modal, #base-prompt-modal, #reward-modal, #inventory-menu { background-color: rgba(0, 0, 0, 0.85); backdrop-filter: blur(8px); }
        #lore-content, #base-prompt-content, #reward-content { box-shadow: 0 0 50px rgba(0,0,0,0.8); background: #111; border: 2px solid #333; }
        
        /* RAIN */
        .floating-item { position: absolute; font-size: 24px; opacity: 0; pointer-events: none; z-index: 5; }
        @keyframes float-fall { 0% { top: -10%; opacity: 0; } 10% { opacity: 1; } 100% { top: 110%; opacity: 0; transform: rotate(720deg); } }

        /* MARQUEE CONTAINER */
        .marquee-container {
            overflow: hidden;
            white-space: nowrap;
            position: relative;
        }
        .marquee-content {
            display: inline-block;
            animation: marquee 20s linear infinite;
            min-width: 100%; 
        }

        /* RED CARPET STYLES */
        .red-carpet {
            background: linear-gradient(to bottom, #6a0000, #b20000, #6a0000);
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.8), 0 5px 15px rgba(0,0,0,0.5);
            border-top: 4px solid #FFD700;
            border-bottom: 4px solid #FFD700;
            position: relative;
        }
        .carpet-item-box {
            animation: carpet-slide-in 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
            flex-shrink: 0;
            box-shadow: 0 4px 8px rgba(0,0,0,0.5);
            background: #111;
            transition: all 0.3s;
            cursor: pointer;
        }
        .carpet-item-box:hover {
            transform: scale(1.1) translateY(-5px);
            z-index: 50;
            border-color: #fff !important;
        }
        @keyframes carpet-slide-in {
            0% { transform: translateX(100px) scale(0.5); opacity: 0; }
            100% { transform: translateX(0) scale(1); opacity: 1; }
        }

        /* NEW FLASHING LIGHTS EFFECT */
        @keyframes title-flash {
            0% { text-shadow: 0 0 5px #05d9e8, 0 0 10px #05d9e8; color: #05d9e8; transform: scale(1); }
            50% { text-shadow: 0 0 20px #fff, 0 0 40px #05d9e8, 0 0 60px #fff; color: #fff; transform: scale(1.02); }
            100% { text-shadow: 0 0 5px #05d9e8, 0 0 10px #05d9e8; color: #05d9e8; transform: scale(1); }
        }
        .flash-effect {
            animation: title-flash 0.8s infinite ease-in-out;
        }

        /* BASE SECTION STYLES */
        .base-slot {
            width: 70px; height: 70px;
            background: rgba(0,0,0,0.5);
            border: 2px dashed #444;
            border-radius: 12px;
            display: flex; align-items: center; justify-content: center;
            position: relative; overflow: hidden;
            transition: all 0.2s;
        }
        .base-slot.filled {
            border: 2px solid #FFD700;
            background: #000;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.2);
            cursor: pointer;
        }
        .base-slot.filled:hover { transform: scale(1.05); box-shadow: 0 0 15px #FFD700; }
        
        /* CAMERA FLASH EFFECT */
        @keyframes flash-burst {
            0% { transform: scale(0); opacity: 0; }
            50% { transform: scale(2); opacity: 0.8; box-shadow: 0 0 30px white; }
            100% { transform: scale(0.5); opacity: 0; }
        }
        .animate-flash-burst {
            animation: flash-burst 0.15s ease-out forwards;
        }

        /* COLLECT ANIMATION */
        @keyframes collect-zoom {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.5) rotate(10deg); opacity: 0.8; filter: brightness(2); box-shadow: 0 0 20px white; }
            100% { transform: scale(0); opacity: 0; }
        }
        .animate-collect-zoom {
            animation: collect-zoom 0.3s ease-out forwards !important;
            pointer-events: none; /* Prevent double clicks */
            z-index: 100;
        }

        /* LUCK INDICATOR POP & FLASH */
        @keyframes luck-pop {
            0% { transform: scale(0) rotate(-10deg); opacity: 0; }
            70% { transform: scale(1.2) rotate(5deg); opacity: 1; }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }
        @keyframes luck-flash {
            0%, 100% { filter: brightness(1) drop-shadow(0 0 5px gold); }
            50% { filter: brightness(1.5) drop-shadow(0 0 15px white); }
        }
        .animate-luck-pop {
            animation: luck-pop 0.4s cubic-bezier(0.17, 0.89, 0.32, 1.49) forwards, luck-flash 0.8s infinite ease-in-out;
        }

        /* LANTERN FESTIVAL MODE EFFECTS */
        .lantern-festival-overlay {
            position: absolute;
            inset: 0;
            pointer-events: none;
            z-index: 25;
            background: linear-gradient(to bottom, rgba(5, 5, 15, 0.85), rgba(20, 10, 30, 0.6));
            mix-blend-mode: multiply;
        }
        
        .lantern-festival-neon-overlay {
            position: absolute;
            inset: 0;
            pointer-events: none;
            z-index: 26;
            background: linear-gradient(90deg, rgba(0,242,255,0.15), rgba(139, 92, 246, 0.15), rgba(0,242,255,0.15));
            background-size: 200% 100%;
            mix-blend-mode: screen;
            animation: lantern-festival-neon-flow 10s linear infinite;
        }
        @keyframes lantern-festival-neon-flow {
            0% { background-position: 100% 0; }
            100% { background-position: -100% 0; }
        }

        /* Cool Color Shift for Carpet in Lantern Festival Mode */
        .red-carpet.lantern-festival-mode-active {
            background: linear-gradient(to bottom, #1a0b2e, #4338ca, #1a0b2e) !important; /* Midnight Purple/Blue */
            border-top-color: #05d9e8 !important; /* Cyan Neon Border */
            border-bottom-color: #05d9e8 !important;
            box-shadow: inset 0 2px 20px rgba(0,0,0,0.8), 0 0 15px rgba(5, 217, 232, 0.4) !important;
            transition: all 1s ease;
        }

        /* Glitter Overlay */
        .lantern-festival-glitter {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            z-index: 28; /* Below items (z30) but above dark overlay (z25) */
            background-image: 
                radial-gradient(white, rgba(255,255,255,.2) 2px, transparent 2.5px),
                radial-gradient(white, rgba(255,255,255,.15) 1px, transparent 1.5px),
                radial-gradient(rgba(5, 217, 232, 0.8), rgba(255,255,255,.1) 2px, transparent 3px);
            background-size: 250px 250px, 150px 150px, 100px 100px;
            background-position: 0 0, 40px 60px, 80px 20px;
            animation: glitter-anim 6s linear infinite;
            opacity: 0.6;
            mix-blend-mode: screen;
        }
        @keyframes glitter-anim {
            0% { background-position: 0 0, 40px 60px, 80px 20px; opacity: 0.4; }
            50% { opacity: 0.8; }
            100% { background-position: 250px 250px, 190px 210px, 180px 120px; opacity: 0.4; }
        }

        /* Lantern Glow Animation */
        @keyframes lantern-pulse {
            0% { text-shadow: 0 0 10px rgba(255, 140, 0, 0.6), 0 5px 15px rgba(255, 60, 0, 0.4); filter: brightness(1); }
            50% { text-shadow: 0 0 25px rgba(255, 140, 0, 1), 0 5px 25px rgba(255, 60, 0, 0.8); filter: brightness(1.3); }
            100% { text-shadow: 0 0 10px rgba(255, 140, 0, 0.6), 0 5px 15px rgba(255, 60, 0, 0.4); filter: brightness(1); }
        }
        .animate-lantern-glow {
            animation: lantern-pulse 2.5s infinite ease-in-out;
        }

        /* FIREWORKS ANIMATION */
        .firework-particle {
            position: absolute;
            width: 4px;
            height: 4px;
            border-radius: 50%;
            animation: firework-burst-anim 1s ease-out forwards;
        }
        @keyframes firework-burst-anim {
            0% { transform: translate(0, 0) scale(1); opacity: 1; }
            50% { opacity: 1; }
            100% { transform: translate(var(--tx), var(--ty)) scale(0); opacity: 0; }
        }

        /* Street Lamp Effect on Items */
        .lantern-festival-mode-active .carpet-item-box {
            /* Simulates light cone from top (Street Lamp) - Now brighter and pops above dark overlay */
            box-shadow: inset 0 40px 40px -10px rgba(255, 250, 150, 0.6), 0 0 15px rgba(255, 255, 255, 0.2) !important;
            filter: brightness(1.3) contrast(1.15) saturate(1.2);
            border-color: rgba(255, 255, 255, 0.5) !important;
            transition: all 0.5s ease;
            position: relative;
            z-index: 30; /* Lifts item above the dark overlay */
        }
        .lantern-festival-mode-active .carpet-item-box:hover {
            filter: brightness(1.4) contrast(1);
            box-shadow: inset 0 0 20px rgba(255, 255, 255, 0.8), 0 0 25px rgba(255, 255, 255, 0.6) !important;
            z-index: 60;
            transform: scale(1.15) translateY(-5px);
        }

        /* DISCO BALL ANIMATION */
        @keyframes disco-party {
            0% { transform: rotate(0deg) scale(1); filter: hue-rotate(0deg) drop-shadow(0 0 5px gold); }
            25% { transform: rotate(15deg) scale(1.1); filter: hue-rotate(90deg) drop-shadow(0 0 15px cyan); }
            50% { transform: rotate(0deg) scale(1.2); filter: hue-rotate(180deg) drop-shadow(0 0 20px magenta); }
            75% { transform: rotate(-15deg) scale(1.1); filter: hue-rotate(270deg) drop-shadow(0 0 15px lime); }
            100% { transform: rotate(0deg) scale(1); filter: hue-rotate(360deg) drop-shadow(0 0 5px gold); }
        }
        .animate-disco {
            animation: disco-party 1s infinite linear;
        }

        /* DISCO LIGHTS OVERLAY */
        .disco-overlay {
            position: absolute;
            inset: 0;
            pointer-events: none;
            z-index: 25;
            background: linear-gradient(45deg, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #4b0082, #9400d3);
            background-size: 400% 400%;
            opacity: 0.3;
            mix-blend-mode: hard-light;
            animation: disco-bg-anim 1s ease infinite;
        }
        @keyframes disco-bg-anim {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* RAINBOW MODE THEME (Global Overrides) */
        #rainbow-border-overlay {
            position: fixed;
            inset: 0;
            z-index: 9999;
            pointer-events: none;
            border: 12px solid transparent;
            border-image: linear-gradient(45deg, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #4b0082, #9400d3) 1;
            animation: rainbow-border-flash 0.5s infinite alternate;
            mix-blend-mode: screen;
        }
        
        @keyframes rainbow-border-flash {
            0% { filter: hue-rotate(0deg) brightness(1); }
            100% { filter: hue-rotate(45deg) brightness(1.5); }
        }

        /* Apply Rainbow Theme to Main Containers when Active */
        body.rainbow-mode-active .bg-gray-900,
        body.rainbow-mode-active #base,
        body.rainbow-mode-active #shop,
        body.rainbow-mode-active #collection,
        body.rainbow-mode-active section#play .bg-gray-900 {
            border: 4px solid transparent !important;
            background-image: linear-gradient(#111, #111), linear-gradient(45deg, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #4b0082, #9400d3) !important;
            background-origin: border-box;
            background-clip: content-box, border-box;
            box-shadow: 0 0 20px rgba(255, 0, 0, 0.5) !important;
            animation: rainbow-box-pulse 2s infinite;
        }
        
        body.rainbow-mode-active .nav-container {
            border-bottom: 4px solid transparent !important;
            border-image: linear-gradient(90deg, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #4b0082, #9400d3) 1 !important;
        }

        @keyframes rainbow-box-pulse {
            0% { box-shadow: 0 0 15px rgba(255,0,0,0.3); }
            50% { box-shadow: 0 0 30px rgba(0,255,255,0.5); }
            100% { box-shadow: 0 0 15px rgba(255,0,0,0.3); }
        }

        /* QUICK COLLECT BUTTON EFFECTS */
        @keyframes quick-money-pulse {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 215, 0, 0.7); filter: brightness(1); }
            70% { transform: scale(1.15); box-shadow: 0 0 0 10px rgba(255, 215, 0, 0); filter: brightness(1.3); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 215, 0, 0); filter: brightness(1); }
        }
        .quick-collect-active {
            animation: quick-money-pulse 1.2s infinite ease-in-out !important;
            border-color: #FFD700 !important;
            opacity: 1 !important;
            cursor: pointer !important;
        }

        /* CURRENCY POP AND SHOOT EFFECT */
        @keyframes currency-pop-shoot {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
            20% { transform: translate(-50%, -100%) scale(1.5); opacity: 1; }
            45% { transform: translate(-50%, -120%) scale(1.2); opacity: 1; }
            100% { top: 20px; opacity: 0; transform: translate(-50%, 0) scale(0.5); }
        }
        .currency-pop-text {
            position: fixed;
            z-index: 1000;
            pointer-events: none;
            font-weight: 900;
            text-shadow: 0 0 10px rgba(0,0,0,0.8), 0 0 5px rgba(255,255,255,0.4);
            animation: currency-pop-shoot 1.4s cubic-bezier(0.18, 0.89, 0.32, 1.28) forwards;
        }

        /* SAKURA ANIMATION */
        @keyframes sakura-fall {
            0% { top: -10%; transform: translateX(0) rotate(0deg); opacity: 0; }
            10% { opacity: 0.8; }
            50% { transform: translateX(50px) rotate(180deg); }
            100% { top: 110%; transform: translateX(-50px) rotate(360deg); opacity: 0; }
        }
        .sakura-petal {
            position: absolute;
            pointer-events: none;
            z-index: 0;
            animation-name: sakura-fall;
            animation-timing-function: linear;
        }

        /* --- NEW LANTERN FESTIVAL THEME STYLES --- */
        @keyframes neon-flicker {
            0%, 19%, 21%, 23%, 25%, 54%, 56%, 100% { opacity: 1; text-shadow: 0 0 10px #ff0055, 0 0 20px #ff0055, 0 0 40px #ff0055; box-shadow: 0 0 15px #ff0055, inset 0 0 10px #ff0055; }
            20%, 22%, 24%, 55% { opacity: 0.4; text-shadow: none; box-shadow: none; }
        }

        body.lantern-festival-theme-active #main-game-box {
            border: 12px solid #1a1a1a !important;
            background-color: #0d0d0d !important;
            background-image: linear-gradient(rgba(255, 69, 0, 0.05) 1px, transparent 1px), linear-gradient(90deg, rgba(255, 69, 0, 0.05) 1px, transparent 1px) !important;
            background-size: 20px 20px !important;
            box-shadow: 
                0 0 0 4px #444, 
                0 0 30px rgba(255, 69, 0, 0.3),
                inset 0 0 50px rgba(0,0,0,0.9) !important;
            border-radius: 10px !important; /* Sharper building look */
            position: relative;
        }

        /* Architectural Pagoda Detail */
        body.lantern-festival-theme-active #main-game-box::before {
            content: '';
            position: absolute;
            top: -25px;
            left: 10%;
            right: 10%;
            height: 20px;
            background: #222;
            border-top: 4px solid #ff4500;
            clip-path: polygon(0 100%, 10% 0, 90% 0, 100% 100%);
            box-shadow: 0 -5px 15px rgba(255, 69, 0, 0.4);
            z-index: -1;
        }

        /* Tokyo Neon Sign Button Transformation */
        body.lantern-festival-theme-active #pull-btn {
            background: #000 !important;
            border: 3px solid #ff0055 !important;
            border-radius: 0px !important;
            color: #ff0055 !important;
            font-family: 'Orbitron', sans-serif;
            font-weight: 900;
            letter-spacing: 4px;
            text-transform: uppercase;
            text-shadow: 0 0 10px #ff0055, 0 0 20px #ff0055;
            box-shadow: 0 0 15px #ff0055, inset 0 0 10px #ff0055 !important;
            animation: neon-flicker 4s infinite alternate;
            padding: 20px 0 !important;
            height: auto !important;
            line-height: 1.2;
            overflow: visible !important;
        }

        body.lantern-festival-theme-active #pull-btn::before {
            content: 'BRAINROT ‚Ä¢ „Éñ„É¨„Ç§„É≥„É≠„ÉÉ„Éà';
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 8px;
            background: #ff0055;
            color: #000;
            padding: 2px 8px;
            white-space: nowrap;
            letter-spacing: 1px;
            box-shadow: 0 0 10px #ff0055;
        }

        body.lantern-festival-theme-active #pull-btn span {
            display: block;
            transform: scale(1.1, 1.4); /* Stretch vertically like a sign */
        }

        body.lantern-festival-theme-active #rot-screen {
            border-color: #333 !important;
            box-shadow: inset 0 0 40px rgba(0,0,0,1), 0 0 10px rgba(255, 255, 255, 0.1) !important;
        }

        /* AD BANNER */
        .ad-banner {
            background: linear-gradient(90deg, #ff2a6d, #0d0208, #ff2a6d);
            border-bottom: 2px solid var(--leaf-green);
            animation: ad-pulse 3s infinite;
        }
        @keyframes ad-pulse {
            0%, 100% { border-color: var(--leaf-green); box-shadow: 0 0 5px var(--leaf-green); }
            50% { border-color: #fff; box-shadow: 0 0 15px var(--strawberry-red); }
        }

        /* GOLD ICON HELPER */
        .gold-img, .silver-img, .moonstone-img {
            width: 1em;
            height: 1em;
            display: inline-block;
            vertical-align: middle;
            object-fit: contain;
            filter: drop-shadow(0 0 2px rgba(255, 215, 0, 0.5));
            margin-top: -2px;
        }

        /* FESTIVAL TIMER UI */
        #festival-countdown, #rainbow-countdown {
            font-family: 'Orbitron', sans-serif;
            text-shadow: 0 0 5px rgba(255, 140, 0, 0.5);
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid rgba(255, 140, 0, 0.3);
            border-radius: 4px;
            padding: 2px 6px;
            min-width: 140px;
        }
        #rainbow-countdown {
            text-shadow: 0 0 5px rgba(168, 85, 247, 0.5);
            border-color: rgba(168, 85, 247, 0.3);
            color: #A855F7;
        }
        
        .maxxer-badge {
            transition: all 0.3s;
            animation: maxxer-float 4s infinite ease-in-out;
        }
        @keyframes maxxer-float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        /* STATS DISPLAY IN MODAL */
        .lore-stat-box {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 8px;
            text-align: center;
        }
        .lore-stat-label {
            font-size: 8px;
            text-transform: uppercase;
            color: #888;
            font-weight: 900;
            letter-spacing: 1px;
            margin-bottom: 2px;
        }
        .lore-stat-value {
            font-size: 14px;
            font-weight: 900;
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
        }

        /* STAR RATINGS */
        .star-rating {
            position: absolute;
            display: flex;
            flex-direction: row-reverse; /* Align right */
            gap: 0px;
            z-index: 15;
            pointer-events: none;
            line-height: 1;
            filter: drop-shadow(0 1px 1px rgba(0,0,0,0.8));
        }
        .star-rating span {
            color: #FFD700;
            font-weight: 900;
        }
        /* Context specific sizing */
        .draw-stars { bottom: 5px; right: 5px; }
        .draw-stars span { font-size: 14px; text-shadow: 2px 2px 0 #000; }
        
        .carpet-stars { bottom: 1px; right: 1px; } 
        .carpet-stars span { font-size: 8px; letter-spacing: -2px; text-shadow: 1px 1px 0 #000; }
        
        .collection-stars { bottom: 1px; right: 1px; }
        .collection-stars span { font-size: 10px; letter-spacing: -2px; text-shadow: 1px 1px 0 #000; }

    </style>
</head>
<body class="antialiased selection:bg-pink-500 selection:text-white flex flex-col min-h-screen">

    <!-- FACE BUTTONS BAR -->
    <div id="face-buttons-bar" class="fixed right-2 md:right-6 top-1/2 -translate-y-1/2 z-[100] flex flex-col items-center gap-4">
        <!-- DRAW BUTTON (Game Controller) -->
        <a href="#play" class="w-12 h-12 md:w-16 md:h-16 bg-gray-900/90 rounded-full border-2 border-purple-500/50 flex items-center justify-center text-purple-500 shadow-[0_0_15px_rgba(168,85,247,0.3)] transition-all hover:scale-110 active:scale-95 group opacity-80 hover:opacity-100" title="Go to Draw">
            <i data-lucide="gamepad-2" class="w-6 h-6 md:w-8 md:h-8"></i>
        </a>
        <!-- BASE BUTTON -->
        <a href="#base" class="w-12 h-12 md:w-16 md:h-16 bg-gray-900/90 rounded-full border-2 border-cyan-400/50 flex items-center justify-center text-cyan-400 shadow-[0_0_15px_rgba(34,211,238,0.3)] transition-all hover:scale-110 active:scale-95 group opacity-80 hover:opacity-100" title="Go to Base">
            <i data-lucide="home" class="w-6 h-6 md:w-8 md:h-8"></i>
        </a>
        <!-- PERMANENT FIXED COLLECT BUTTON -->
        <button id="global-collect-btn" onclick="collectIncome()" class="w-16 h-16 md:w-24 md:h-24 bg-gray-900/90 rounded-full border-4 border-[#ff2a6d]/50 flex items-center justify-center text-3xl md:text-5xl shadow-[0_0_20px_rgba(255,42,109,0.3)] transition-all hover:scale-110 active:scale-95 group opacity-40 hover:opacity-100" title="Collect Passive Income">
            <span class="group-active:scale-90 transition-transform">üí∞</span>
        </button>
        <!-- SHOP BUTTON -->
        <a href="#shop" class="w-12 h-12 md:w-16 md:h-16 bg-gray-900/90 rounded-full border-2 border-yellow-500/50 flex items-center justify-center text-yellow-500 shadow-[0_0_15px_rgba(234,179,8,0.3)] transition-all hover:scale-110 active:scale-95 group opacity-80 hover:opacity-100" title="Go to Shop">
            <i data-lucide="shopping-cart" class="w-6 h-6 md:w-8 md:h-8"></i>
        </a>
        <!-- STASH BUTTON -->
        <a href="#stash" class="w-12 h-12 md:w-16 md:h-16 bg-gray-900/90 rounded-full border-2 border-[#05d9e8]/50 flex items-center justify-center text-[#05d9e8] shadow-[0_0_15px_rgba(5,217,232,0.3)] transition-all hover:scale-110 active:scale-95 group opacity-80 hover:opacity-100" title="Go to Stash">
            <i data-lucide="backpack" class="w-6 h-6 md:w-8 md:h-8"></i>
        </a>
    </div>

    <!-- FLOATING INVENTORY TOGGLE BUTTON -->
    <button onclick="toggleInventory()" class="fixed bottom-6 right-6 md:bottom-10 md:right-10 w-16 h-16 md:w-20 md:h-20 bg-gray-900/90 rounded-full border-2 border-[#ff2a6d] flex items-center justify-center text-[#ff2a6d] shadow-[0_0_20px_rgba(255,42,109,0.4)] transition-all hover:scale-110 active:scale-95 group z-[140]" title="Open Inventory">
        <i data-lucide="package" class="w-8 h-8 md:w-10 md:h-10 group-hover:animate-bounce"></i>
    </button>

    <!-- ADMIN PANEL -->
    <div id="admin-panel" class="admin-panel">
        <h5 class="brand-font text-[#ff2a6d] font-black text-xs uppercase mb-4 tracking-widest border-b border-[#ff2a6d]/30 pb-2">Admin Dashboard</h5>
        
        <div class="mb-4">
            <p class="text-[9px] text-gray-500 uppercase font-black mb-2">Toggle Modes</p>
            <button onclick="toggleMusic()" class="admin-btn"><i data-lucide="music"></i> Lantern Festival</button>
            <button onclick="toggleDisco()" class="admin-btn"><i data-lucide="sparkles"></i> Rainbow Mode</button>
            <button onclick="activateGlitchMode()" class="admin-btn"><i data-lucide="alert-triangle"></i> Glitch Mode</button>
            <button onclick="triggerTifaRush()" class="admin-btn"><i data-lucide="zap"></i> Tifa Rush</button>
            <button onclick="triggerCowgirlRush()" class="admin-btn"><i data-lucide="star"></i> Cowgirl Rush</button>
            <button onclick="toggleAdminAbuse()" class="admin-btn"><i data-lucide="skull"></i> Admin Abuse Start</button>
        </div>

        <div class="mb-4">
            <p class="text-[9px] text-gray-500 uppercase font-black mb-2">Luck Multipliers</p>
            <div class="grid grid-cols-2 gap-1">
                <button onclick="applyLuckBonus(2, 60000)" class="admin-btn text-[9px]">Luck x2</button>
                <button onclick="applyLuckBonus(4, 60000)" class="admin-btn text-[9px]">Luck x4</button>
                <button onclick="applyLuckBonus(10, 60000)" class="admin-btn text-[9px]">Luck x10</button>
                <button onclick="applyLuckBonus(20, 60000)" class="admin-btn text-[9px]">Luck x20</button>
                <button onclick="applyLuckBonus(100, 30000)" class="admin-btn text-[9px] border-yellow-500">Luck x100</button>
                <button onclick="applyLuckBonus(1, 0)" class="admin-btn text-[9px] border-red-500">Clear</button>
            </div>
        </div>

        <div class="mb-2">
            <p class="text-[9px] text-gray-500 uppercase font-black mb-2">Rewards</p>
            <button onclick="activateDevMode()" class="admin-btn"><i data-lucide="database"></i> Load Dev Resources</button>
            <button onclick="unlockAllMaxxers()" class="admin-btn"><i data-lucide="trophy"></i> Unlock All Maxxers</button>
        </div>

        <button onclick="toggleAdminPanelUI()" class="mt-4 w-full py-2 bg-white/10 hover:bg-white/20 text-white font-black uppercase text-[9px] rounded tracking-widest">Close Panel</button>
    </div>

    <!-- BROADCAST CONTAINER -->
    <div id="broadcast-container" class="fixed top-24 left-1/2 -translate-x-1/2 z-[200] w-full max-w-lg pointer-events-none px-4 space-y-2"></div>

    <!-- Navigation Header -->
    <header class="fixed top-0 left-0 w-full z-50 nav-container bg-black/95 backdrop-blur-xl border-b-2 border-[#ff2a6d] shadow-[0_0_20px_rgba(255,42,109,0.2)]">
        <!-- AD BANNER WITH INTEGRATED TIMERS -->
        <div class="ad-banner w-full py-1 relative overflow-hidden group">
            <div class="max-w-7xl mx-auto px-4 flex items-center justify-between">
                <!-- FESTIVAL TIMER (LEFT) -->
                <div class="flex items-center gap-1.5 min-w-[120px]">
                    <button id="music-btn" disabled class="bg-indigo-900/20 text-white/40 w-6 h-6 flex items-center justify-center rounded-full border border-white/10 transition-all text-xs cursor-default pointer-events-none" title="Lantern Festival Mode">
                        üèÆ
                    </button>
                    <div id="festival-countdown" class="text-[8px] md:text-[9px] brand-font text-orange-400 font-black tracking-tighter uppercase py-0.5">
                        NEXT: 00:00:00
                    </div>
                </div>

                <!-- CENTER BRANDING -->
                <a href="#anthem" class="flex flex-col items-center justify-center leading-tight">
                    <span class="brand-font text-[9px] md:text-[10px] font-black tracking-[0.1em] text-white uppercase text-center">
                        <span class="text-[#39ff14]">Strawberry Elephant</span> (Brainrot Rap)
                    </span>
                    <span class="animate-pulse bg-white text-black px-2 text-[8px] md:text-[9px] font-black mt-0.5">OUT NOW</span>
                </a>

                <!-- RAINBOW TIMER (RIGHT) -->
                <div class="flex items-center gap-1.5 justify-end min-w-[120px]">
                    <div id="rainbow-countdown" class="text-[8px] md:text-[9px] brand-font text-purple-400 font-black tracking-tighter uppercase text-right py-0.5">
                        NEXT: 00:00:00
                    </div>
                    <button id="disco-btn" disabled class="bg-purple-600/20 text-white/40 w-6 h-6 flex items-center justify-center rounded-full border border-white/10 transition-all text-xs cursor-default pointer-events-none" title="Rainbow Mode">
                        ü™©
                    </button>
                </div>
            </div>
        </div>

        <!-- TOP CURRENCY BAR -->
        <div class="bg-black/95 py-1 px-4 border-b border-white/10 flex flex-wrap justify-end gap-2 md:gap-4 text-[10px] md:text-xs font-black brand-font tracking-widest text-white/90">
             <span id="h-silver" class="flex items-center gap-1">üîò 0</span>
             <span id="h-gold" class="flex items-center gap-1"><img src="https://storage.googleapis.com/msgsndr/ECv14A6vdkfO0uFvxGNG/media/695daa9894b57da33ecbc3be.png" class="gold-img" alt="Gold"> 0</span>
             <span id="h-stars">üåü 0</span>
             <span id="h-diamonds">üíé 0</span>
             <span id="h-moonstones" class="flex items-center gap-1">ü™® 0</span>
             <span id="h-power-crystals" class="flex items-center gap-1 transition-all duration-300">üîÆ 0/100</span>
        </div>

        <!-- Integrated Logo + Buttons Bar -->
        <div class="py-4 flex flex-col items-center gap-4">
            <a href="https://brainrotcollector.com" class="text-3xl md:text-4xl font-black brand-font tracking-tighter text-white drop-shadow-[0_0_10px_rgba(255,42,109,0.8)] glitch-text hover:scale-105 transition-transform duration-200" data-text="BRAINROT COLLECTOR">
                BRAINROT <span class="text-[#39ff14] drop-shadow-[0_0_10px_rgba(57,255,20,0.8)]">COLLECTOR</span>
            </a>
            
            <nav class="flex gap-4">
                <a href="#base" class="nav-btn yellow">BASE</a>
                <a href="#shop" class="nav-btn green">SHOP</a>
                <a href="#play" class="nav-btn gamble-effect">DRAW</a>
                <a href="#stash" class="nav-btn blue">STASH</a>
            </nav>
        </div>
    </header>

    <!-- Main Game Section -->
    <section id="play" class="pt-44 pb-0 relative flex-grow flex flex-col items-center justify-start min-h-[85vh] overflow-hidden">
        <!-- Backgrounds -->
        <div class="absolute inset-0 -z-20">
            <!-- Default: Tokyo Night -->
            <img id="bg-tokyo" src="https://images.unsplash.com/photo-1534270804882-6b5048b1c1fc?q=80&w=2560&auto=format&fit=crop" alt="Tokyo Night Neon" class="absolute inset-0 w-full h-full object-cover opacity-60 filter contrast-125 brightness-75 saturate-150 transition-opacity duration-1000">
            
            <!-- Rainbow Mode: Disco Room -->
            <img id="bg-disco" src="https://images.unsplash.com/photo-1566737236500-c8ac43014a67?q=80&w=2560&auto=format&fit=crop" alt="Disco Room" class="absolute inset-0 w-full h-full object-cover opacity-0 filter contrast-125 brightness-90 saturate-150 transition-opacity duration-1000">
            
            <div class="absolute inset-0 bg-gradient-to-b from-black/60 via-purple-900/20 to-black/90 mix-blend-multiply"></div>
            <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/dark-matter.png')] opacity-30"></div>
        </div>
        
        <!-- Falling Sakura Container -->
        <div id="sakura-container" class="absolute inset-0 pointer-events-none -z-10"></div>

        <div class="relative w-full max-w-xl mx-auto px-4 z-10">
            
            <!-- DRAW WINDOW (UP) -->
            <div id="rot-screen" class="bg-black border-4 border-gray-700 rounded-xl h-56 md:h-72 flex items-center justify-center mb-0 overflow-hidden relative shadow-[inset_0_0_30px_rgba(0,0,0,1)]">
                
                <!-- NEW LUCK MULTIPLIER BADGE (TOP LEFT OF WINDOW) -->
                <div id="multiplier-badge" class="hidden absolute top-2 left-2 z-50">
                    <div id="multiplier-text" class="bg-gradient-to-br from-yellow-400 via-white to-yellow-600 text-black font-black px-3 py-1 rounded-lg border-2 border-white shadow-[0_0_15px_rgba(255,215,0,0.8)] whitespace-nowrap text-[10px] md:text-xs uppercase brand-font italic tracking-tighter"></div>
                </div>

                <div id="rot-content" class="text-center w-full px-4 flex items-center justify-center flex-wrap gap-4">
                    <div class="text-center">
                        <div class="text-6xl md:text-7xl mb-4 animate-bounce">‚ùì</div>
                        <div class="text-xl md:text-2xl font-mono text-gray-500 uppercase tracking-widest">Ready to Rot</div>
                    </div>
                </div>
                <div id="rarity-flash" class="absolute inset-0 pointer-events-none opacity-0 transition-opacity duration-300 mix-blend-screen bg-white"></div>
            </div>

            <!-- RED CARPET -->
            <div class="mt-0 mb-0 relative max-w-xl mx-auto overflow-hidden rounded-xl">
                <div id="rot-history" class="red-carpet h-20 flex items-center justify-start gap-4 px-6 overflow-hidden">
                    <div id="carpet-placeholder" class="text-white/30 font-black brand-font uppercase text-xs tracking-widest w-full text-center">Draw to Walk the Red Carpet</div>
                </div>
                <div class="absolute inset-0 pointer-events-none bg-gradient-to-r from-black/40 via-transparent to-black/40"></div>
            </div>

            <!-- Main Game Box (DOWN) -->
            <div id="main-game-box" class="bg-gray-900 rounded-3xl p-6 md:p-8 rainbow-border-box shadow-2xl relative">
                
                <!-- LUCKY ROT TICKET SLOTS -->
                <div class="flex items-center gap-2 md:gap-6 pb-1 justify-center relative z-10">
                    <div id="btn-lucky-rot" onclick="activateRot('lucky')" class="group flex items-center gap-2 cursor-pointer transition-all hover:brightness-125 p-2 rounded-xl border border-transparent" title="Use Lucky Rot">
                        <span class="text-2xl filter drop-shadow-[0_0_8px_rgba(234,179,8,0.6)] group-hover:scale-110 transition-transform">üéüÔ∏è</span>
                        <span id="game-lucky-count" class="text-yellow-400 font-mono font-black text-xs tracking-widest">0</span>
                    </div>
                    <div id="btn-grand-rot" onclick="activateRot('grand')" class="group flex items-center gap-2 cursor-pointer transition-all hover:brightness-125 p-2 rounded-xl border border-transparent" title="Use Grand Lucky">
                        <span class="text-2xl filter drop-shadow-[0_0_8px_rgba(6,182,212,0.6)] group-hover:scale-110 transition-transform">üéü</span>
                        <span id="game-grand-count" class="text-cyan-400 font-mono font-black text-xs tracking-widest">0</span>
                    </div>
                    <div id="btn-crazy-rot" onclick="activateRot('crazy')" class="group flex items-center gap-2 cursor-pointer transition-all hover:brightness-125 p-2 rounded-xl border border-transparent" title="Use Crazy Lucky">
                        <span class="text-2xl filter drop-shadow-[0_0_8px_rgba(168,85,247,0.6)] group-hover:scale-110 transition-transform">üéÅ</span>
                        <span id="game-crazy-count" class="text-purple-400 font-mono font-black text-xs tracking-widest">0</span>
                    </div>
                </div>

                <div class="relative z-20">
                    <button onclick="pullRot()" id="pull-btn" class="w-full py-4 text-white font-black text-2xl md:text-3xl uppercase rounded-xl transition-transform active:scale-95 group relative overflow-hidden gamble-effect disabled:opacity-80 disabled:cursor-not-allowed" style="border-width: 0 0 4px 0 !important;">
                        <span class="relative z-10">DRAW BRAINROT</span>
                    </button>
                    <!-- AUTO BUTTON (IN BORDER UNDER DRAW) -->
                    <button onclick="toggleLiveRoll()" id="live-roll-btn" class="w-full mt-1 bg-green-600 hover:bg-green-500 active:scale-95 text-white font-black brand-font text-[10px] uppercase tracking-[0.2em] py-1.5 rounded-b-xl border-t-2 border-white/10 shadow-[0_5px_15px_rgba(0,0,0,0.3)] flex items-center justify-center gap-2 transition-all disabled:opacity-50 disabled:cursor-not-allowed">
                        <i data-lucide="play" class="w-3 h-3"></i>
                        AUTO
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- INVENTORY (MENU) -->
    <div id="inventory-menu" class="fixed inset-0 z-[150] hidden flex flex-col justify-end items-center pointer-events-none pb-24 md:pb-10 bg-black/50 backdrop-blur-sm transition-all duration-300">
        <div class="pointer-events-auto transform transition-transform duration-300 translate-y-0 scale-100">
             <div class="flex flex-col items-center gap-1 mb-4 px-2 mt-0 max-w-2xl mx-auto relative z-10">
                <div class="flex flex-col items-center gap-2 bg-gray-900/95 p-4 rounded-2xl border-2 border-[#ff2a6d] shadow-[0_0_50px_rgba(255,42,109,0.3)] w-fit relative">
                    <!-- Close Button -->
                    <button onclick="toggleInventory()" class="absolute -top-3 -right-3 w-8 h-8 bg-red-600 rounded-full text-white font-bold border border-white flex items-center justify-center shadow-lg hover:scale-110 transition-transform">X</button>
                    
                    <div class="flex items-center gap-2 pb-2 border-b border-white/10 w-full justify-center">
                        <div onclick="activateSpecial('god')" class="group flex flex-col items-center justify-center gap-0.5 cursor-pointer bg-gray-900/80 hover:bg-cyan-900/30 w-10 py-1.5 rounded border border-cyan-500/30 hover:border-cyan-500 transition-all" title="Use 100% Brainrot God">
                            <span class="text-lg filter drop-shadow-[0_0_5px_rgba(6,182,212,0.5)] group-hover:scale-110 transition-transform leading-none">üß†</span>
                            <span id="menu-count-god" class="text-cyan-400 font-mono text-[9px] font-bold leading-none mt-0.5">x0</span>
                        </div>
                        <div onclick="activateSpecial('secret')" class="group flex flex-col items-center justify-center gap-0.5 cursor-pointer bg-gray-900/80 hover:bg-purple-900/30 w-10 py-1.5 rounded border border-purple-500/30 hover:border-purple-500 transition-all" title="Use 100% Secret">
                            <span class="text-lg filter drop-shadow-[0_0_5px_rgba(6,182,212,0.5)] group-hover:scale-110 transition-transform leading-none">üîí</span>
                            <span id="menu-count-secret" class="text-purple-400 font-mono text-[9px] font-bold leading-none mt-0.5">x0</span>
                        </div>
                        <div onclick="activateSpecial('goat')" class="group flex flex-col items-center justify-center gap-0.5 cursor-pointer bg-gray-900/80 hover:bg-yellow-900/30 w-10 py-1.5 rounded border border-yellow-500/30 hover:border-yellow-500 transition-all" title="Use 100% GOAT">
                            <span class="text-lg filter drop-shadow-[0_0_5px_rgba(234,179,8,0.5)] group-hover:scale-110 transition-transform leading-none">üêê</span>
                            <span id="menu-count-goat" class="text-yellow-400 font-mono text-[9px] font-bold leading-none mt-0.5">x0</span>
                        </div>
                        <div onclick="activateSpecial('ultimate')" class="group flex flex-col items-center justify-center gap-0.5 cursor-pointer bg-gray-900/80 hover:bg-gray-700/50 w-10 py-1.5 rounded border border-white/30 hover:border-white transition-all" title="Use Refill">
                            <span class="text-lg filter drop-shadow-[0_0_5px_rgba(255,255,255,0.5)] group-hover:scale-110 transition-transform leading-none">‚ö°</span>
                            <span id="menu-count-ultimate" class="text-white font-mono text-[9px] font-bold leading-none mt-0.5">x0</span>
                        </div>
                        <div onclick="activateSpecial('admin')" class="group flex flex-col items-center justify-center gap-0.5 cursor-pointer bg-gray-900/80 hover:bg-red-900/30 w-10 py-1.5 rounded border border-red-500/30 hover:border-red-500 transition-all" title="Use Admin Abuse">
                            <span class="text-lg filter drop-shadow-[0_0_5px_rgba(239,68,68,0.5)] group-hover:scale-110 transition-transform leading-none">üö®</span>
                            <span id="menu-count-admin" class="text-red-500 font-mono text-[9px] font-bold leading-none mt-0.5">x0</span>
                        </div>
                    </div>
                    <div class="flex items-center gap-2 justify-center w-full">
                        <div onclick="activateTimeBonus(2)" class="group flex flex-col items-center justify-center gap-0.5 cursor-pointer bg-gray-900/80 hover:bg-green-900/30 w-12 py-1.5 rounded border border-green-500/30 hover:border-green-500 transition-all" title="Use 2x Luck Bonus">
                            <span class="text-green-400 font-mono font-black text-[10px] leading-none">2x</span>
                            <span class="text-lg filter drop-shadow-[0_0_5px_rgba(74,222,128,0.5)] group-hover:scale-110 transition-transform leading-none">‚ö°</span>
                            <span id="base-bonus-2" class="text-white/60 font-mono text-[9px] font-bold leading-none mt-0.5">x0</span>
                        </div>
                        <div onclick="activateTimeBonus(4)" class="group flex flex-col items-center justify-center gap-0.5 cursor-pointer bg-gray-900/80 hover:bg-blue-900/30 w-12 py-1.5 rounded border border-blue-500/30 hover:border-blue-500 transition-all" title="Use 4x Luck Bonus">
                            <span class="text-blue-400 font-mono font-black text-[10px] leading-none">4x</span>
                            <span class="text-lg filter drop-shadow-[0_0_5px_rgba(96,165,250,0.5)] group-hover:scale-110 transition-transform leading-none">‚ö°</span>
                            <span id="base-bonus-4" class="text-white/60 font-mono text-[9px] font-bold leading-none mt-0.5">x0</span>
                        </div>
                        <div onclick="activateTimeBonus(10)" class="group flex flex-col items-center justify-center gap-0.5 cursor-pointer bg-gray-900/80 hover:bg-purple-900/30 w-12 py-1.5 rounded border border-purple-500/30 hover:border-purple-500 transition-all" title="Use 10x Luck Bonus">
                            <span class="text-purple-400 font-mono font-black text-[10px] leading-none">10x</span>
                            <span class="text-lg filter drop-shadow-[0_0_5px_rgba(168,85,247,0.5)] group-hover:scale-110 transition-transform leading-none">‚ö°</span>
                            <span id="base-bonus-10" class="text-white/60 font-mono text-[9px] font-bold leading-none mt-0.5">x0</span>
                        </div>
                        <div onclick="activateTimeBonus(20)" class="group flex flex-col items-center justify-center gap-0.5 cursor-pointer bg-gray-900/80 hover:bg-yellow-900/30 w-12 py-1.5 rounded border border-yellow-500/30 hover:border-yellow-500 transition-all" title="Use 20x Luck Bonus">
                            <span class="text-yellow-400 font-mono font-black text-[10px] leading-none">20x</span>
                            <span class="text-lg filter drop-shadow-[0_0_5px_rgba(234,179,8,0.5)] group-hover:scale-110 transition-transform leading-none">‚ö°</span>
                            <span id="base-bonus-20" class="text-white/60 font-mono text-[9px] font-bold leading-none mt-0.5">x0</span>
                        </div>
                    </div>
                </div>
                <span class="text-[12px] font-black text-[#ff2a6d] tracking-[0.2em] uppercase animate-pulse drop-shadow-md bg-black/80 px-2 rounded">INVENTORY</span>
            </div>
        </div>
    </div>

    <!-- YOUR BASE SECTION -->
    <section id="base" class="py-12 bg-black">
        <div class="max-w-7xl mx-auto px-4">
            <div class="bg-black border-4 border-cyan-400 rounded-3xl p-6 relative overflow-hidden shadow-[0_0_30px_rgba(5,217,232,0.2)]">
                <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')] opacity-20"></div>
                <h3 class="text-3xl font-black mb-6 text-center uppercase tracking-widest drop-shadow-md brand-font flash-effect">YOUR BASE</h3>
                <div class="relative z-10 flex flex-col items-center justify-center mb-6">
                    <div class="bg-gray-900/90 border-2 border-cyan-500/50 rounded-xl p-4 flex items-center gap-4 shadow-lg backdrop-blur-sm">
                        <div class="text-center">
                            <div class="text-[10px] text-cyan-400 font-bold uppercase tracking-wider">Passive Income</div>
                            <div id="pending-silver-display" class="text-xl font-black text-white whitespace-pre-line">0 üîò</div>
                        </div>
                        <button onclick="collectIncome()" id="collect-btn" class="bg-gradient-to-r from-green-500 to-emerald-600 hover:scale-105 active:scale-95 transition-all text-white font-black uppercase px-6 py-2 rounded-lg shadow-[0_0_15px_rgba(16,185,129,0.4)] disabled:opacity-50 disabled:cursor-not-allowed">
                            COLLECT
                        </button>
                    </div>
                    <div class="text-[9px] text-gray-500 mt-1 uppercase tracking-widest font-mono text-center">Generates <span id="rate-display">0</span> / sec</div>
                </div>
                <div class="flex justify-between items-end max-w-2xl mx-auto mb-4 px-2 relative z-10">
                    <p class="text-gray-500 text-[10px] uppercase font-bold tracking-tighter text-left leading-tight w-2/3">Click carpet draws to move them here.<br>These are your permanent assets.</p>
                    <button onclick="sortBase()" class="text-[10px] font-bold uppercase bg-cyan-900/30 text-cyan-400 hover:bg-cyan-400 hover:text-black border border-cyan-400/50 hover:border-cyan-400 rounded px-3 py-1 transition-all flex items-center gap-1 shadow-[0_0_10px_rgba(5,217,232,0.1)] hover:shadow-[0_0_15px_rgba(5,217,232,0.4)]">
                        SORT üîΩ
                    </button>
                </div>
                <div id="base-grid" class="grid grid-cols-3 sm:grid-cols-5 gap-4 relative z-10 max-w-2xl mx-auto"></div>
            </div>
        </div>
    </section>

    <!-- SHOP SECTION -->
    <section id="shop" class="py-12 bg-black border-t-4 border-[#FFD700]">
        <div class="max-w-7xl mx-auto px-4">
            <h3 class="text-3xl font-black text-[#FFD700] mb-8 text-center uppercase tracking-widest brand-font">üõí ROT SHOP üõí</h3>
            
            <!-- Lucky Tickets Section -->
            <div class="mb-12 bg-gray-900/50 rounded-3xl p-6 border-2 border-yellow-500/30">
                <h4 class="text-xl font-black text-yellow-400 mb-6 text-center uppercase tracking-widest brand-font">üé∞ LUCKY TICKETS üé∞</h4>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="bg-gray-900 p-4 rounded-xl border border-yellow-500/50 text-center">
                        <h4 class="text-yellow-400 font-bold mb-2 text-sm uppercase">LUCKY ROT (10x Luck)</h4>
                        
                        <div class="grid grid-cols-2 gap-2">
                             <button onclick="purchaseItem('lucky', 'lucky', 'silver', 10000000000)" class="buy-btn bg-gray-200 text-black flex items-center justify-center gap-1">Buy 10B <span class="silver-img-container"></span></button>
                             <button onclick="purchaseItem('lucky', 'lucky', 'gold', 10000000000)" class="buy-btn bg-yellow-600 text-white flex items-center justify-center gap-1">Buy 10B <img src="https://storage.googleapis.com/msgsndr/ECv14A6vdkfO0uFvxGNG/media/695daa9894b57da33ecbc3be.png" class="gold-img" alt="Gold"></button>
                        </div>
                    </div>
                    <div class="bg-gray-900 p-4 rounded-xl border border-cyan-500/50 text-center">
                        <h4 class="text-cyan-400 font-bold mb-2 text-sm uppercase">GRAND LUCKY (20x Luck)</h4>
                        
                         <div class="grid grid-cols-2 gap-2">
                             <button onclick="purchaseItem('lucky', 'grand', 'silver', 1000000000000)" class="buy-btn bg-gray-200 text-black flex items-center justify-center gap-1">Buy 1T <span class="silver-img-container"></span></button>
                             <button onclick="purchaseItem('lucky', 'grand', 'gold', 1000000000000)" class="buy-btn bg-yellow-600 text-white flex items-center justify-center gap-1">Buy 1T <img src="https://storage.googleapis.com/msgsndr/ECv14A6vdkfO0uFvxGNG/media/695daa9894b57da33ecbc3be.png" class="gold-img" alt="Gold"></button>
                        </div>
                    </div>
                    <div class="bg-gray-900 p-4 rounded-xl border border-purple-500/50 text-center">
                        <h4 class="text-purple-400 font-bold mb-2 text-sm uppercase">CRAZY LUCKY (40x Luck)</h4>
                        
                         <div class="grid grid-cols-2 gap-2">
                             <button onclick="purchaseItem('lucky', 'crazy', 'silver', 10000000000000)" class="buy-btn bg-gray-200 text-black flex items-center justify-center gap-1">Buy 10T <span class="silver-img-container"></span></button>
                             <button onclick="purchaseItem('lucky', 'crazy', 'gold', 10000000000000)" class="buy-btn bg-yellow-600 text-white flex items-center justify-center gap-1">Buy 10T <img src="https://storage.googleapis.com/msgsndr/ECv14A6vdkfO0uFvxGNG/media/695daa9894b57da33ecbc3be.png" class="gold-img" alt="Gold"></button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Special Store Section -->
            <div class="mb-12 bg-gray-900/50 rounded-3xl p-6 border-2 border-red-500/30">
                <h4 class="text-xl font-black text-red-500 mb-6 text-center uppercase tracking-widest brand-font">üö® SPECIAL OFFERS üö®</h4>
                
                <!-- Luck Bonus Section -->
                <div class="mb-8 p-4 bg-black/40 rounded-xl">
                    <h5 class="text-lg font-bold text-[#39ff14] mb-4 text-center uppercase tracking-widest">‚è≥ Luck Bonus (60 Sec)</h5>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                         <div class="bg-gray-900 p-2 rounded border border-green-500/50 text-center">
                            <div id="inv-bonus-2" class="special-slot" onclick="activateTimeBonus(2)">‚ö°</div>
                            <div class="text-[10px] font-bold mt-1 text-green-400 uppercase">LUCK x2</div>
                            <div class="flex flex-col gap-1 mt-2">
                                <button onclick="purchaseItem('time', 'x2', 'silver', 2500000000)" class="buy-btn bg-gray-200 text-black flex items-center justify-center gap-1">2.5B <span class="silver-img-container"></span></button>
                                <button onclick="purchaseItem('time', 'x2', 'gold', 2500000000)" class="buy-btn bg-yellow-600 text-white flex items-center justify-center gap-1">2.5B <img src="https://storage.googleapis.com/msgsndr/ECv14A6vdkfO0uFvxGNG/media/695daa9894b57da33ecbc3be.png" class="gold-img" alt="Gold"></button>
                            </div>
                        </div>
                        <div class="bg-gray-900 p-2 rounded border border-blue-500/50 text-center">
                            <div id="inv-bonus-4" class="special-slot" onclick="activateTimeBonus(4)">‚ö°</div>
                            <div class="text-[10px] font-bold mt-1 text-blue-400 uppercase">LUCK x4</div>
                            <div class="flex flex-col gap-1 mt-2">
                                <button onclick="purchaseItem('time', 'x4', 'silver', 5000000000)" class="buy-btn bg-gray-200 text-black flex items-center justify-center gap-1">5B <span class="silver-img-container"></span></button>
                                <button onclick="purchaseItem('time', 'x4', 'gold', 5000000000)" class="buy-btn bg-yellow-600 text-white flex items-center justify-center gap-1">5B <img src="https://storage.googleapis.com/msgsndr/ECv14A6vdkfO0uFvxGNG/media/695daa9894b57da33ecbc3be.png" class="gold-img" alt="Gold"></button>
                            </div>
                        </div>
                        <div class="bg-gray-900 p-2 rounded border border-purple-500/50 text-center">
                            <div id="inv-bonus-10" class="special-slot" onclick="activateTimeBonus(10)">‚ö°</div>
                            <div class="text-[10px] font-bold mt-1 text-purple-400 uppercase">LUCK x10</div>
                            <div class="flex flex-col gap-1 mt-2">
                                <button onclick="purchaseItem('time', 'x10', 'silver', 10000000000)" class="buy-btn bg-gray-200 text-black flex items-center justify-center gap-1">10B <span class="silver-img-container"></span></button>
                                <button onclick="purchaseItem('time', 'x10', 'gold', 10000000000)" class="buy-btn bg-yellow-600 text-white flex items-center justify-center gap-1">10B <img src="https://storage.googleapis.com/msgsndr/ECv14A6vdkfO0uFvxGNG/media/695daa9894b57da33ecbc3be.png" class="gold-img" alt="Gold"></button>
                            </div>
                        </div>
                        <div class="bg-gray-900 p-2 rounded border border-yellow-500/50 text-center">
                            <div id="inv-bonus-20" class="special-slot" onclick="activateTimeBonus(20)">‚ö°</div>
                            <div class="text-[10px] font-bold mt-1 text-yellow-400 uppercase">LUCK x20</div>
                            <div class="flex flex-col gap-1 mt-2">
                                <button onclick="purchaseItem('time', 'x20', 'silver', 10000000000000)" class="buy-btn bg-gray-200 text-black flex items-center justify-center gap-1">10T <span class="silver-img-container"></span></button>
                                <button onclick="purchaseItem('time', 'x20', 'gold', 10000000000000)" class="buy-btn bg-yellow-600 text-white flex items-center justify-center gap-1">10T <img src="https://storage.googleapis.com/msgsndr/ECv14A6vdkfO0uFvxGNG/media/695daa9894b57da33ecbc3be.png" class="gold-img" alt="Gold"></button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Main Specials Grid -->
                <div class="grid grid-cols-3 md:grid-cols-5 gap-4">
                    <div class="bg-gray-900 p-2 rounded border border-cyan-500/50 text-center">
                        <div id="inv-guaranteed-god" class="special-slot" onclick="activateSpecial('god')">üß†</div>
                        <div class="text-[10px] font-bold mt-1 text-cyan-400">100% God</div>
                        <button onclick="purchaseItem('special', 'god', 'stars', 1)" class="buy-btn bg-yellow-600 text-white">1 üåü</button>
                    </div>
                    <div class="bg-gray-900 p-2 rounded border border-purple-500/50 text-center">
                        <div id="inv-guaranteed-secret" class="special-slot" onclick="activateSpecial('secret')">üîí</div>
                        <div class="text-[10px] font-bold mt-1 text-purple-400">100% Secret</div>
                        <div class="flex gap-1 mt-2"><button onclick="purchaseItem('special', 'secret', 'stars', 5)" class="buy-btn bg-yellow-600 text-white">5üåü</button><button onclick="purchaseItem('special', 'secret', 'diamonds', 1)" class="buy-btn bg-cyan-600 text-white">1üíé</button></div>
                    </div>
                    <div class="bg-gray-900 p-2 rounded border border-yellow-500/50 text-center">
                        <div id="inv-guaranteed-goat" class="special-slot" onclick="activateSpecial('goat')">üêê</div>
                        <div class="text-[10px] font-bold mt-1 text-yellow-400">100% GOAT</div>
                        <div class="flex gap-1 mt-2"><button onclick="purchaseItem('special', 'goat', 'diamonds', 5)" class="buy-btn bg-cyan-600 text-white">5üíé</button><button onclick="purchaseItem('special', 'goat', 'moonstones', 1)" class="buy-btn bg-purple-600 text-white flex items-center justify-center gap-1">1 <span class="moonstone-img-container"></span></button></div>
                    </div>
                    <div class="bg-gray-900 p-2 rounded border border-white/50 text-center">
                        <div id="inv-ultimate-refill" class="special-slot" onclick="activateSpecial('ultimate')">‚ö°</div>
                        <div class="text-[10px] font-bold mt-1 text-white">REFILL</div>
                        <div class="flex gap-1 mt-2"><button onclick="purchaseItem('special', 'ultimate', 'diamonds', 15)" class="buy-btn bg-cyan-600 text-white">15üíé</button><button onclick="purchaseItem('special', 'ultimate', 'moonstones', 5)" class="buy-btn bg-purple-600 text-white flex items-center justify-center gap-1">5 <span class="moonstone-img-container"></span></button></div>
                    </div>
                    <div class="bg-gray-900 p-2 rounded border border-red-500/50 text-center">
                        <div id="inv-admin-abuse" class="special-slot" onclick="activateSpecial('admin')">üö®</div>
                        <div class="text-[10px] font-bold mt-1 text-red-500">ABUSE</div>
                         <button onclick="purchaseItem('special', 'admin', 'moonstones', 1)" class="buy-btn bg-purple-600 text-white flex items-center justify-center gap-1">1 <span class="moonstone-img-container"></span></button>
                    </div>
                </div>

                <!-- BASE UPGRADES SECTION -->
                <div class="mt-8 p-4 bg-black/40 rounded-xl">
                    <h5 class="text-lg font-bold text-cyan-400 mb-4 text-center uppercase tracking-widest">üèóÔ∏è BASE EXPANSIONS</h5>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="bg-gray-900 p-3 rounded border border-cyan-500/50 text-center">
                            <div id="shop-expander-1" class="text-4xl mb-2">üèóÔ∏è</div>
                            <div class="text-[10px] font-bold text-white uppercase">Base Expander I</div>
                            <div class="text-[8px] text-gray-500 mb-2">+5 BASE SLOTS</div>
                            <button id="btn-expander-1" onclick="purchaseUpgrade('expander1', 100000000000, 'silver')" class="buy-btn bg-gray-200 text-black flex items-center justify-center gap-1 disabled:opacity-30">100B <span class="silver-img-container"></span></button>
                        </div>
                        <div class="bg-gray-900 p-3 rounded border border-cyan-500/50 text-center">
                            <div id="shop-expander-2" class="text-4xl mb-2">üèôÔ∏è</div>
                            <div class="text-[10px] font-bold text-white uppercase">Base Expander II</div>
                            <div class="text-[8px] text-gray-500 mb-2">+5 BASE SLOTS</div>
                            <button id="btn-expander-2" onclick="purchaseUpgrade('expander2', 10000000000000, 'gold')" class="buy-btn bg-yellow-600 text-white flex items-center justify-center gap-1 disabled:opacity-30">10T <img src="https://storage.googleapis.com/msgsndr/ECv14A6vdkfO0uFvxGNG/media/695daa9894b57da33ecbc3be.png" class="gold-img" alt="Gold"></button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ANTHEM SECTION -->
    <section id="anthem" class="py-16 bg-[#0d0208] relative overflow-hidden border-t-4 border-[#ff2a6d]">
        <div class="absolute inset-0 z-0">
             <img src="https://images.unsplash.com/photo-1587393855524-087f83d95bc9?q=80&w=2560&auto=format&fit=crop" alt="Strawberry Background" class="w-full h-full object-cover opacity-20 blur-sm mix-blend-screen">
        </div>
        <div id="floating-container" class="absolute inset-0 pointer-events-none z-0"></div>
        <div class="max-w-4xl mx-auto px-4 text-center relative z-10">
            <div class="animate-float mb-8 relative group cursor-pointer inline-block">
                <div class="absolute inset-0 bg-[#ff2a6d] blur-3xl opacity-20 group-hover:opacity-40 transition-opacity rounded-full"></div>
                <svg viewBox="0 0 200 200" class="w-48 h-48 md:w-64 md:h-64 relative z-10 drop-shadow-2xl filter drop-shadow-[0_0_10px_rgba(255,46,99,0.5)]">
                    <path d="M100 100 Q100 130 100 150 Q100 180 120 170" fill="none" stroke="#fff" stroke-width="16" stroke-linecap="round"/>
                    <path d="M40 100 Q40 60 80 50 L120 50 Q160 60 160 100 L160 140 Q160 160 140 160 L130 160 L130 130 L70 130 L70 160 L60 160 Q40 160 40 140 Z" fill="#ff2e63" stroke="#fff" stroke-width="2"/>
                    <path d="M40 80 Q10 70 20 120 Q50 110 40 80" fill="#00ff00" stroke="#fff" stroke-width="1"/>
                    <path d="M160 80 Q190 70 180 120 Q150 110 160 80" fill="#00ff00" stroke="#fff" stroke-width="1"/>
                    <path d="M100 100 Q100 130 100 150 Q100 180 120 170" fill="none" stroke="#ff2e63" stroke-width="12" stroke-linecap="round"/>
                    <circle cx="80" cy="90" r="5" fill="white"/>
                    <circle cx="120" cy="90" r="5" fill="white"/>
                    <circle cx="80" cy="90" r="2" fill="black"/>
                    <circle cx="120" cy="90" r="2" fill="black"/>
                    <g fill="#fff" opacity="0.6">
                        <circle cx="60" cy="80" r="1.5"/> <circle cx="70" cy="110" r="1.5"/> <circle cx="90" cy="70" r="1.5"/>
                        <circle cx="110" cy="110" r="1.5"/> <circle cx="130" cy="80" r="1.5"/> <circle cx="140" cy="120" r="1.5"/>
                        <circle cx="100" cy="100" r="1.5"/> <circle cx="50" cy="130" r="1.5"/> <circle cx="150" cy="130" r="1.5"/>
                    </g>
                    <path d="M90 50 L100 30 L110 50" fill="#00ff00" stroke="#fff" stroke-width="1"/>
                </svg>
            </div>
            <h2 class="text-4xl md:text-7xl font-black glitch-text text-white leading-[0.85] tracking-tighter mb-4" data-text="STRAWBERRY ELEPHANT">
                STRAWBERRY<br>ELEPHANT
            </h2>
            <h3 class="text-xl md:text-3xl font-bold text-[#05d9e8] brand-font mb-10 tracking-widest" style="text-shadow: 0 0 10px #05d9e8;">
                (BRAINROT RAP)
            </h3>
            
            <div class="flex flex-wrap justify-center items-center gap-6">
                <a href="https://open.spotify.com/artist/6nhnWCtncJkfYrThzexaks" target="_blank" class="w-16 h-16 bg-[#1DB954] text-black rounded-full hover:scale-110 transition-transform flex items-center justify-center shadow-[0_0_20px_rgba(29,185,84,0.4)]" title="Spotify">
                    <i data-lucide="play-circle" class="w-8 h-8"></i>
                </a>
                <a href="https://music.apple.com/us/artist/kodo-pulsecraft/1824100825" target="_blank" class="w-16 h-16 bg-[#FA243C] text-white rounded-full hover:scale-110 transition-transform flex items-center justify-center shadow-[0_0_20px_rgba(250,36,60,0.4)]" title="Apple Music">
                    <i data-lucide="music" class="w-8 h-8"></i>
                </a>
                <a href="https://www.youtube.com/@mildly.unusual" target="_blank" class="w-16 h-16 bg-[#FF0000] text-white rounded-full hover:scale-110 transition-transform flex items-center justify-center shadow-[0_0_20px_rgba(255,0,0,0.4)]" title="YouTube">
                    <i data-lucide="youtube" class="w-8 h-8"></i>
                </a>
            </div>
            
            <div class="mt-12 flex justify-center">
                <iframe allow="autoplay *; encrypted-media *; fullscreen *; clipboard-write" frameborder="0" height="175" style="width:100%;max-width:660px;overflow:hidden;border-radius:10px;" sandbox="allow-forms allow-popups allow-same-origin allow-scripts allow-storage-access-by-user-activation allow-top-navigation-by-user-activation" src="https://embed.music.apple.com/us/song/strawberry-elephant-brainrot-rap-feat-brainrot-collector/1866613359"></iframe>
            </div>
        </div>
    </section>

    <!-- ADMIN ABUSE TIMER SECTION -->
    <section id="admin-section" class="py-8 bg-red-950/80 border-t-4 border-red-600">
        <div id="admin-abuse-countdown" class="max-w-2xl mx-auto px-4 text-center">
            <h4 class="text-[#ff0000] font-black brand-font uppercase tracking-widest text-lg md:text-xl mb-4 animate-pulse flex items-center justify-center gap-2">
                <i data-lucide="alert-triangle" class="w-6 h-6"></i>
                ADMIN ABUSE COUNTDOWN
                <i data-lucide="alert-triangle" class="w-6 h-6"></i>
            </h4>
            <div class="bg-black/50 rounded-xl p-4 border border-red-500/50 inline-block w-full">
                <div id="timer-display" class="text-4xl sm:text-6xl md:text-7xl font-mono font-black text-white tracking-widest" style="text-shadow: 0 0 10px #ff0000;">--:--:--</div>
            </div>
        </div>
    </section>

    <!-- YOUR STASH SECTION -->
    <section id="stash" class="py-12 bg-black border-t-4 border-[#05d9e8]">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <h2 class="text-3xl md:text-5xl font-black brand-font mb-8 text-center">
                <span class="text-transparent bg-clip-text bg-gradient-to-r from-[#39ff14] to-[#05d9e8]">YOUR STASH</span>
            </h2>

            <!-- CURRENCIES -->
            <div class="flex flex-wrap justify-center gap-4 mb-8">
                <div class="bg-gray-900 border border-gray-700 px-6 py-3 rounded-full flex items-center gap-3">
                    <span id="stash-silver-icon" class="text-2xl flex items-center">üîò</span>
                    <div><div class="text-xs text-gray-400 font-bold uppercase">Silver</div><div id="silver-count-display" class="text-xl font-bold text-gray-300">0</div></div>
                </div>
                <div class="bg-gray-900 border border-gray-700 px-6 py-3 rounded-full flex items-center gap-3">
                    <span class="text-2xl flex items-center"><img src="https://storage.googleapis.com/msgsndr/ECv14A6vdkfO0uFvxGNG/media/695daa9894b57da33ecbc3be.png" class="w-8 h-8 object-contain" alt="Gold"></span>
                    <div><div class="text-xs text-gray-400 font-bold uppercase">Gold</div><div id="gold-count-display" class="text-xl font-bold text-yellow-500">0</div></div>
                </div>
                <div class="bg-gray-900 border border-gray-700 px-6 py-3 rounded-full flex items-center gap-3">
                    <span class="text-2xl">üåü</span>
                    <div><div class="text-xs text-gray-400 font-bold uppercase">Stars</div><div id="star-count-display" class="text-xl font-bold text-yellow-400">0</div></div>
                </div>
                <div class="bg-gray-900 border border-gray-700 px-6 py-3 rounded-full flex items-center gap-3">
                    <span class="text-2xl">üíé</span>
                    <div><div class="text-xs text-gray-400 font-bold uppercase">Diamonds</div><div id="diamond-count-display" class="text-xl font-bold text-cyan-400">0</div></div>
                </div>
                <div class="bg-gray-900 border border-gray-700 px-6 py-3 rounded-full flex items-center gap-3">
                    <span id="stash-moonstone-icon" class="text-2xl flex items-center">ü™®</span>
                    <div><div class="text-xs text-gray-400 font-bold uppercase">Moonstones</div><div id="moonstone-count-display" class="text-xl font-bold text-purple-400">0</div></div>
                </div>
                <div id="power-crystal-stash-container" class="bg-gray-900 border border-purple-500/50 px-6 py-3 rounded-full flex items-center gap-3 transition-all duration-300">
                    <span class="text-2xl">üîÆ</span>
                    <div><div class="text-xs text-purple-400 font-bold uppercase">Power Crystals</div><div id="power-crystal-count-display" class="text-xl font-bold text-white">0/100</div></div>
                </div>
            </div>

            <!-- MAXXERS (RARITY REWARDS) -->
            <div id="maxxers-container" class="flex flex-wrap justify-center gap-4 border-t border-white/5 pt-8">
                <!-- Dynamically filled -->
            </div>
            <div id="base-luck-display" class="text-[10px] brand-font text-white/40 uppercase mt-4 tracking-widest font-black">Base Luck Multiplier: x<span id="bonus-luck-val">1</span></div>
            
            <!-- Innate Upgrades List -->
            <div id="innate-upgrades-container" class="mt-8 flex flex-wrap justify-center gap-4 border-t border-white/5 pt-8">
                <!-- Expanders will show up here -->
            </div>
        </div>
    </section>

    <!-- Collection Section -->
    <section id="collection" class="py-12 bg-black border-t-4 border-[#39ff14]">
        <div class="max-w-7xl mx-auto px-4 text-center">
             <h3 class="text-2xl md:text-4xl brand-font font-black uppercase tracking-tighter text-white glitch-text mb-4" data-text="BRAINROT COLLECTION">
                BRAINROT COLLECTION
            </h3>
            <p class="text-xs text-gray-500 mb-8 uppercase tracking-widest font-bold">Only brainrot added to the base are permanently collected.</p>
            
            <div class="mb-12 space-y-6 text-left">
                <div class="bg-gray-900/80 border-2 border-cyan-500/50 rounded-2xl p-4">
                    <div class="flex justify-between items-center mb-2">
                        <h4 class="text-cyan-400 font-black uppercase text-sm tracking-widest">üåü BRAINROT GODS COLLECTED</h4>
                        <span class="text-xs text-gray-400 font-mono"><span id="god-progress-count">0</span>/10</span>
                    </div>
                    <div id="god-progress-bar" class="h-12 bg-black/50 rounded border border-cyan-500/30 flex items-center px-2 gap-1 overflow-hidden relative"></div>
                </div>
                <div class="bg-gray-900/80 border-2 border-purple-500/50 rounded-2xl p-4">
                    <div class="flex justify-between items-center mb-2">
                        <h4 class="text-purple-400 font-black uppercase text-sm tracking-widest">üíé SECRETS COLLECTED</h4>
                        <span class="text-xs text-gray-400 font-mono"><span id="secret-progress-count">0</span>/10</span>
                    </div>
                    <div id="secret-progress-bar" class="h-12 bg-black/50 rounded border border-purple-500/30 flex items-center px-2 gap-1 overflow-hidden relative"></div>
                </div>
                <div class="bg-gray-900/80 border-2 border-yellow-500/50 rounded-2xl p-4">
                    <div class="flex justify-between items-center mb-2">
                        <h4 class="text-purple-400 font-black uppercase text-sm tracking-widest">üåô GOATS COLLECTED</h4>
                        <span class="text-xs text-gray-400 font-mono"><span id="goat-progress-count">0</span>/10</span>
                    </div>
                    <div id="goat-progress-bar" class="h-12 bg-black/50 rounded border border-yellow-500/30 flex items-center px-2 gap-1 overflow-hidden relative"></div>
                </div>
            </div>
            
            <div id="collection-grid" class="flex flex-col gap-6 text-left"></div>
        </div>
    </section>

    <!-- TITLE SECTION -->
    <div class="w-full max-w-xl mx-auto px-4 z-20 mb-12 mt-12 relative">
        <div class="flex flex-col items-center">
            <div class="brand-font text-[10px] md:text-xs font-black tracking-[0.4em] text-[#ff2a6d] uppercase mb-1 drop-shadow-sm">System: COLLECT THE</div>
            <div class="relative group">
                <h1 class="text-4xl md:text-7xl font-black brand-font tracking-tighter text-white glitch-text filter drop-shadow-[0_0_15px_rgba(5,217,232,0.8)]" data-text="BRAINROT">
                    BRAIN<span class="text-[#39ff14]">ROT</span>
                </h1>
                <div class="absolute -bottom-2 left-0 w-full h-1 bg-gradient-to-r from-transparent via-[#ff2a6d] to-transparent opacity-50"></div>
            </div>
        </div>
    </div>

    <!-- HIT COUNTER -->
    <div class="flex justify-center mb-4">
        <!-- hitwebcounter Code START -->
        <a href="https://www.hitwebcounter.com/" target="_blank">
        <img src="https://hitwebcounter.com/counter/counter.php?page=21468090&style=0024&nbdigits=9&type=page&initCount=0" title="Free Tools" alt="Free Tools" border="0" /></a>
    </div>

    <!-- Footer -->
    <footer class="bg-black border-t border-gray-800 py-8 text-center text-xs text-gray-500 font-mono">
        <p class="mb-4">BRAINROT COLLECTOR ¬© 2025</p>
        <button onclick="resetGame()" class="text-red-500 hover:text-red-400 underline decoration-dotted mr-4">RESET COLLECTION</button>
        <div class="flex justify-center items-center gap-4 mt-2">
            <button onclick="activateDevMode()" class="text-2xl hover:scale-110 transition-transform" title="Dev Mode">ü§ñ</button>
            <button onclick="toggleAdminPanelUI()" class="text-2xl hover:scale-110 transition-transform text-[#ff2a6d]" title="Admin Panel">üõ†Ô∏è</button>
        </div>
    </footer>

    <!-- MODALS -->
    <div id="lore-modal" class="fixed inset-0 z-[100] hidden flex items-center justify-center p-4">
        <div id="lore-content" class="relative w-full max-w-md rounded-2xl p-8 text-center transform transition-all scale-95 opacity-0 duration-300 border-2 border-white/20">
            <div class="absolute top-4 right-4 text-gray-500 hover:text-white cursor-pointer" onclick="closeLoreModal()"><i data-lucide="x" class="w-8 h-8"></i></div>
            <div id="lore-icon" class="text-8xl mb-4 flex justify-center">‚ùì</div>
            <h2 id="lore-name" class="text-3xl font-black text-white mb-2 brand-font uppercase">NAME</h2>
            <div id="lore-rarity" class="inline-block px-3 py-1 rounded border border-white/20 text-xs font-mono mb-6">RARITY</div>
            
            <!-- STATS DISPLAY -->
            <div id="lore-stats" class="grid grid-cols-3 gap-2 mb-6">
                <div class="lore-stat-box">
                    <div class="lore-stat-label">Buy Price</div>
                    <div id="lore-buy-val" class="lore-stat-value">-</div>
                </div>
                <div class="lore-stat-box">
                    <div class="lore-stat-label">Sell Price</div>
                    <div id="lore-sell-val" class="lore-stat-value">-</div>
                </div>
                <div class="lore-stat-box">
                    <div class="lore-stat-label">Income</div>
                    <div id="lore-income-val" class="lore-stat-value">-</div>
                </div>
            </div>

            <div class="bg-black/50 p-4 rounded-lg border border-white/10 text-left mb-4"><p id="lore-text" class="text-gray-300 font-mono text-sm leading-relaxed">[DATA CORRUPTED]</p></div>
            <div id="sell-btn-container" class="mt-4"></div>
            <button onclick="closeLoreModal()" class="mt-2 w-full py-3 bg-white text-black font-bold uppercase rounded hover:bg-gray-200">CLOSE</button>
        </div>
    </div>

    <!-- REWARD MODAL -->
    <div id="reward-modal" class="fixed inset-0 z-[150] hidden flex items-center justify-center p-4">
        <div id="reward-content" class="relative w-full max-w-sm rounded-3xl p-8 text-center transform transition-all scale-95 opacity-0 duration-500 border-4 border-yellow-400 gamble-effect">
            <div class="absolute -top-12 left-1/2 transform -translate-x-1/2 text-6xl">üèÜ</div>
            <h2 class="text-4xl font-black text-white mb-2 brand-font uppercase italic">RARITY COMPLETE!</h2>
            <p id="reward-rarity-text" class="text-white font-bold mb-6 tracking-widest text-sm bg-black/40 py-1 rounded">ALL COMMON COLLECTED</p>
            <div id="reward-item-icon" class="text-9xl mb-4 animate-bounce">üçÄ</div>
            <h3 id="reward-item-name" class="text-3xl font-black text-yellow-400 mb-2 brand-font">LUCKMAXXER</h3>
            <p class="text-white/80 font-mono text-xs mb-8">+1 BASE LUCK AWARDED</p>
            <button onclick="closeRewardModal()" class="w-full py-4 bg-white text-black font-black uppercase rounded-xl hover:bg-gray-200 transition-all shadow-xl">COLLECT REWARD</button>
        </div>
    </div>

    <!-- BASE PROMPT MODAL -->
    <div id="base-prompt-modal" class="fixed inset-0 z-[110] hidden flex items-center justify-center p-4">
        <div id="base-prompt-content" class="relative w-full max-w-sm rounded-2xl p-8 text-center border-2 border-cyan-400">
            <div id="prompt-icon" class="text-7xl mb-4">‚ùì</div>
            <h2 id="prompt-name" class="text-2xl font-black text-white mb-2">NAME</h2>
            <button id="prompt-confirm-btn" onclick="confirmBaseAdd()" class="w-full py-3 bg-cyan-400 text-black font-black uppercase rounded">BUY</button>
            <button onclick="closeBasePrompt()" class="mt-2 w-full py-2 text-white opacity-50">CANCEL</button>
        </div>
    </div>

    <!-- KO-FI WIDGET -->
    <script src='https://storage.ko-fi.com/cdn/scripts/overlay-widget.js'></script>
    <script>
      kofiWidgetOverlay.draw('brainrotcollector', {
        'type': 'floating-chat',
        'floating-chat.donateButton.text': 'Support me',
        'floating-chat.donateButton.background-color': '#323842',
        'floating-chat.donateButton.text-color': '#fff'
      });
    </script>

    <script>
        // --- GLOBAL ASSETS ---
        var GOLD_IMG_URL = "https://storage.googleapis.com/msgsndr/ECv14A6vdkfO0uFvxGNG/media/695daa9894b57da33ecbc3be.png";
        var SILVER_IMG_URL = "https://storage.googleapis.com/msgsndr/ECv14A6vdkfO0uFvxGNG/media/695dca11b75f6f563f5f04e3.png";
        var MOONSTONE_IMG_URL = "https://storage.googleapis.com/msgsndr/ECv14A6vdkfO0uFvxGNG/media/695df4bcd461d43d7ec7d607.png";
        
        var GOLD_ICON_HTML = `<img src="${GOLD_IMG_URL}" class="gold-img" alt="Gold">`;
        var SILVER_ICON_HTML = `<img src="${SILVER_IMG_URL}" class="silver-img" alt="Silver">`;
        var MOONSTONE_ICON_HTML = `<img src="${MOONSTONE_IMG_URL}" class="moonstone-img" alt="Moonstone">`;

        lucide.createIcons();

        const MAXXER_REWARDS = {
            "COMMON": { name: "Luckmaxxer", icon: "üçÄ", color: "#9E9E9E" },
            "RARE": { name: "Rizzmazzer", icon: "üç∑", color: "#1E40AF" },
            "EPIC": { name: "Sigmamaxxer", icon: "üóø", color: "#7C3AED" },
            "LEGENDARY": { name: "Mewmaxxer", icon: "ü§´", color: "#F59E0B" },
            "MYTHIC": { name: "Edgemaxxer", icon: "üßä", color: "#B91C1C" },
            "BRAINROT_GOD": { name: "Skibidimaxxer", icon: "üöΩ", color: "#00ffff" },
            "SECRET": { name: "Auramaxxer", icon: "‚ú®", color: "#8B5CF6" },
            "GOAT": { name: "Collectmaxxer", icon: "üëë", color: "#FFD700" }
        };

        // --- GAME CONFIG & DATA ---
        var currentMultiplier = 1;
        var bonusBaseLuck = 0; 
        var activeMultiplierType = null;
        var activeTimeBonus = { value: 1, endTime: 0, timerId: null };
        var forcedTierId = null;
        var collectedItemsMap = {}; 
        var inventory = { 
            lucky: 0, 
            grand: 0, 
            crazy: 0, 
            special: { god: 0, secret: 0, goat: 0, ultimate: 0, admin: 0 }, 
            timeBonus: { x2: 0, x4: 0, x10: 0, x20: 0 },
            upgrades: { expander1: false, expander2: false } 
        };
        var currencies = { stars: 0, diamonds: 0, moonstones: 0, gold: 0, silver: 0, powerCrystals: 0 };
        var rewards = {}; 
        var baseInventory = new Array(15).fill(null);
        var pendingBaseItem = null;
        var pendingItemUniqueId = null; 
        var accumulatedSilver = 0; 
        var accumulatedGold = 0;
        var liveRollInterval = null; 
        var fireworksInterval = null; 
        var fsFireworksInterval = null; 
        var isAutoFestivalActive = false; 
        var isAutoRainbowActive = false; 

        // New persistent timer tracking
        var sessionStartTime = Date.now();
        var lastFiveMinuteAward = Date.now();

        function getMaxBaseSlots() {
            let total = 15;
            if (inventory.upgrades.expander1) total += 5;
            if (inventory.upgrades.expander2) total += 5;
            return total;
        }

        var tierConfig = [
            { id: "TIER_MOONSTONE", name: "MOONSTONE", stars: 10, probability: 0.001, borderColor: "#7C3AED", textColor: "#D8B4FE", bg: "bg-purple-900/40" },
            { id: "TIER_LUCK_20", name: "20x LUCK", stars: 9, probability: 0.01, borderColor: "#FBBF24", textColor: "#FDE68A", bg: "bg-yellow-900/40" },
            { id: "TIER_01_GROUP", name: "SPECIAL RARE", stars: 8, probability: 0.06, borderColor: "#60A5FA", textColor: "#93C5FD", bg: "bg-blue-900/40" },
            { id: "TIER_CRAZY", name: "CRAZY LUCKY", stars: 8, probability: 0.08, borderColor: "#EC4899", textColor: "#F9A8D4", bg: "bg-pink-900/40" },
            { id: "TIER_05_GROUP", name: "SPECIAL EPIC", stars: 7, probability: 0.2, borderColor: "#34D399", textColor: "#6EE7B7", bg: "bg-green-900/40" },
            { id: "TIER_10_GROUP", name: "SPECIAL UNCOMMON", stars: 6, probability: 0.4, borderColor: "#F87171", textColor: "#FCA5A5", bg: "bg-red-900/40" },
            { id: "TIER_25_GROUP", name: "SPECIAL COMMON", stars: 5, probability: 0.5, borderColor: "#A78BFA", textColor: "#C4B5FD", bg: "bg-indigo-900/40" },
            { id: "TIER_1_GROUP", name: "BONUS LOOT", stars: 4, probability: 3.0, borderColor: "#FCD34D", textColor: "#FDE68A", bg: "bg-amber-900/40" },
            { id: "TIER_GRAND", name: "GRAND LUCKY", stars: 7, probability: 2.5, borderColor: "#06B6D4", textColor: "#67E8F9", bg: "bg-cyan-900/40" },
            { id: "TIER_5_GROUP", name: "LUCKY FIND", stars: 5, probability: 10.0, borderColor: "#F59E0B", textColor: "#FCD34D", bg: "bg-yellow-800/40" },
            { id: "GOAT", name: "GOAT", stars: 8, probability: 0.073, borderColor: "#FFD700", textColor: "#FFFFFF", bg: "bg-yellow-900/20" },
            { id: "SECRET", name: "SECRET", stars: 7, probability: 0.05, borderColor: "#8B5CF6", textColor: "#8B5CF6", bg: "bg-purple-900/20" },
            { id: "BRAINROT_GOD", name: "BRAINROT GOD", stars: 6, probability: 1.0, borderColor: "#00ffff", textColor: "#00ffff", bg: "bg-cyan-900/20" },
            { id: "MYTHIC", name: "MYTHIC", stars: 5, probability: 5.0, borderColor: "#B91C1C", textColor: "#B91C1C", bg: "bg-red-900/20" },
            { id: "LEGENDARY", name: "LEGENDARY", stars: 4, probability: 10.0, borderColor: "#F59E0B", textColor: "#F59E0B", bg: "bg-orange-900/20" },
            { id: "EPIC", name: "EPIC", stars: 3, probability: 15.0, borderColor: "#7C3AED", textColor: "#7C3AED", bg: "bg-indigo-900/20" },
            { id: "RARE", name: "RARE", stars: 2, probability: 30.0, borderColor: "#1E40AF", textColor: "#1E40AF", bg: "bg-blue-900/20" },
            { id: "COMMON", name: "COMMON", stars: 1, probability: 50.0, borderColor: "#9E9E9E", textColor: "#9E9E9E", bg: "bg-gray-800/20" }
        ];

        // Add Crystal Earning helper
        function addPowerCrystals(amt, x, y) {
            const old = currencies.powerCrystals;
            currencies.powerCrystals = Math.min(100, (currencies.powerCrystals || 0) + amt);
            const diff = currencies.powerCrystals - old;
            if (diff > 0) {
                showFloatingText(`+${diff} üîÆ`, x || window.innerWidth/2, y || window.innerHeight/2, "#a855f7");
                updateStatsUI();
                saveGame();
            }
        }

        var itemDatabase = {
            "TIER_MOONSTONE": [ { name: "Moonstone", icon: MOONSTONE_ICON_HTML, type: "currency", currencyType: "moonstones", value: 1, cost: 1, sell: 1 } ],
            "TIER_LUCK_20": [ { name: "20x Luck", icon: "‚ö°", type: "timeBonus", bonusType: "x20", cost: 1, sell: 1 } ],
            "TIER_01_GROUP": [
                { name: "Diamond", icon: "üíé", type: "currency", currencyType: "diamonds", value: 1, cost: 1, sell: 1 },
                { name: "Gold 100", icon: GOLD_ICON_HTML, type: "currency", currencyType: "gold", value: 100, cost: 1, sell: 1 },
                { name: "Silver 1000", icon: SILVER_ICON_HTML, type: "currency", currencyType: "silver", value: 1000, cost: 1, sell: 1 },
                { name: "10x Luck", icon: "‚ö°", type: "timeBonus", bonusType: "x10", cost: 1, sell: 1 },
                { name: "Guaranteed GOAT", icon: "GOAT", type: "guaranteed", specialType: "goat", cost: 1, sell: 1 },
                { name: "Admin Abuse", icon: "üö®", type: "guaranteed", specialType: "admin", cost: 1, sell: 1 }
            ],
            "TIER_CRAZY": [ { name: "Crazy 777", icon: "üéÅ", type: "lucky", luckyType: "crazy", cost: 100000000, sell: 1 } ],
            "TIER_05_GROUP": [
                { name: "Gold 10", icon: GOLD_ICON_HTML, type: "currency", currencyType: "gold", value: 10, cost: 1, sell: 1 },
                { name: "Silver 100", icon: SILVER_ICON_HTML, type: "currency", currencyType: "silver", value: 100, cost: 1, sell: 1 },
                { name: "4x Luck", icon: "‚ö°", type: "timeBonus", bonusType: "x4", cost: 1, sell: 1 },
                { name: "Guaranteed Secret", icon: "üîí", type: "guaranteed", specialType: "secret", cost: 1, sell: 1 }
            ],
            "TIER_10_GROUP": [
                { name: "Star", icon: "üåü", type: "currency", currencyType: "stars", value: 1, cost: 1, sell: 1 },
                { name: "Gold 5", icon: GOLD_ICON_HTML, type: "currency", currencyType: "gold", value: 5, cost: 1, sell: 1 },
                { name: "Silver 50", icon: SILVER_ICON_HTML, type: "currency", currencyType: "silver", value: 50, cost: 1, sell: 1 },
                { name: "Guaranteed God", icon: "üß†", type: "guaranteed", specialType: "god", cost: 1, sell: 1 }
            ],
            "TIER_25_GROUP": [
                { name: "Gold 2", icon: GOLD_ICON_HTML, type: "currency", currencyType: "gold", value: 2, cost: 1, sell: 1 },
                { name: "Silver 25", icon: SILVER_ICON_HTML, type: "currency", currencyType: "silver", value: 25, cost: 1, sell: 1 }
            ],
            "TIER_1_GROUP": [
                { name: "Gold 1", icon: GOLD_ICON_HTML, type: "currency", currencyType: "gold", value: 1, cost: 1, sell: 1 },
                { name: "2x Luck", icon: "‚ö°", type: "timeBonus", bonusType: "x2", cost: 1, sell: 1 },
                { name: "Cowgirl Rush", icon: "ü§†", type: "timeBonus", bonusType: "x2", cost: 1, sell: 1 }
            ],
            "TIER_GRAND": [ { name: "Grand 777", icon: "üéü", type: "lucky", luckyType: "grand", cost: 50000000, sell: 1 } ],
            "TIER_5_GROUP": [
                { name: "Lucky 777", icon: "üé∞", type: "lucky", luckyType: "lucky", cost: 10000000, sell: 1 },
                { name: "Silver 5", icon: SILVER_ICON_HTML, type: "currency", currencyType: "silver", value: 5, cost: 1, sell: 1 }
            ],
            "COMMON": [
                { name: "Fishini Bossini", icon: "<img src='https://storage.googleapis.com/msgsndr/ECv14A6vdkfO0uFvxGNG/media/695d001622afaa69eabffc61.jpg' class='w-full h-full object-cover rounded-md'>", cost: 50, sell: 25, income: 1, currency: "silver", description: "The slippery boss of the underwater mafia." },
                { name: "Lirili Larilla", icon: "<img src='https://storage.googleapis.com/msgsndr/ECv14A6vdkfO0uFvxGNG/media/695d00166c14153aad55a516.jpg' class='w-full h-full object-cover rounded-md'>", cost: 500, sell: 250, income: 3, currency: "silver", description: "A singing gorilla whose melody destroys braincells." },
                { name: "Tim Cheese", icon: "<img src='https://storage.googleapis.com/msgsndr/ECv14A6vdkfO0uFvxGNG/media/695d0016de2c149d9a338a9b.jpg' class='w-full h-full object-cover rounded-md'>", cost: 1000, sell: 500, income: 5, currency: "silver", description: "A rodent made entirely of processed dairy." },
                { name: "Fluriflura", icon: "<img src='https://storage.googleapis.com/msgsndr/ECv14A6vdkfO0uFvxGNG/media/695d0016d5b483f7cfbb6eec.jpg' class='w-full h-full object-cover rounded-md'>", cost: 1500, sell: 750, income: 7, currency: "silver", description: "A flower that blooms only in the brainrot fog." },
                { name: "Penguino Cocosino", icon: "<img src='https://storage.googleapis.com/msgsndr/ECv14A6vdkfO0uFvxGNG/media/695d001622afaa5739bffc5c.jpg' class='w-full h-full object-cover rounded-md'>", cost: 2000, sell: 1000, income: 9, currency: "silver", description: "A penguin obsessed with tropical coconuts." },
                { name: "Svinina Bombardino", icon: "<img src='https://storage.googleapis.com/msgsndr/ECv14A6vdkfO0uFvxGNG/media/695d0016a88e87ec8db27cc1.jpg' class='w-full h-full object-cover rounded-md'>", cost: 2800, sell: 1400, income: 12, currency: "silver", description: "An explosive pig ready to blow up the sty." },
                { name: "Pipi Kiwi", icon: "<img src='https://storage.googleapis.com/msgsndr/ECv14A6vdkfO0uFvxGNG/media/695d0016de2c144005338a9a.jpg' class='w-full h-full object-cover rounded-md'>", cost: 3500, sell: 1750, income: 15, currency: "silver", description: "A fuzzy bird disguised as a fuzzy fruit." },
                { name: "Pipi Avacocado", icon: "<img src='https://storage.googleapis.com/msgsndr/ECv14A6vdkfO0uFvxGNG/media/695d001694b57d381cae6d1a.jpg' class='w-full h-full object-cover rounded-md'>", cost: 4500, sell: 2250, income: 18, currency: "silver", description: "Millennial toast topping given sentient life." }
            ],
            "RARE": [
                { name: "Trippi Troppi", icon: "üçÑüåÄ", cost: 6000, sell: 3000, income: 25, currency: "silver", description: "A psychedelic mushroom that distorts reality." },
                { name: "Tung Tung Tung Sahur", icon: "ü•Åüåô", cost: 8000, sell: 4000, income: 35, currency: "silver", description: "The loud drums that wake you up for Ramadan meals." },
                { name: "Ganster Footera", icon: "üï∂Ô∏èüëü", cost: 10000, sell: 5000, income: 45, currency: "silver", description: "A sneaker with street attitude and drip." },
                { name: "Boneca Ambalabu", icon: "ü™ÜüéÄ", cost: 12000, sell: 6000, income: 60, currency: "silver", description: "The cursed doll from the viral viral TikTok trend." },
                { name: "Pipi Corni", icon: "üåΩüê•", cost: 15000, sell: 7500, income: 75, currency: "silver", description: "It has the juice, it's a corn-bird hybrid." },
                { name: "Ta Ta Ta Ta Sahur", icon: "ü•Åüåô", cost: 18000, sell: 9000, income: 90, currency: "silver", description: "A faster, more aggressive Sahur drumming rhythm." },
                { name: "Burballoni Watermeloni", icon: "üçâüí•", cost: 22000, sell: 11000, income: 110, currency: "silver", description: "A watermelon rigged to explode with flavor." },
                { name: "Pipi Potato", icon: "ü•îüê•", cost: 26000, sell: 13000, income: 130, currency: "silver", description: "A starchy bird that thrives underground." }
            ],
            "EPIC": [
                { name: "Cappuccino Assassino", icon: "‚òïüó°Ô∏è", cost: 35000, sell: 17500, income: 170, currency: "silver", description: "A caffeinated hitman aimed at your heart rate." },
                { name: "Burr Burr Patapim", icon: "‚ùÑÔ∏èüî®", cost: 40000, sell: 20000, income: 200, currency: "silver", description: "The shivering sound of ice breaking under pressure." },
                { name: "Trulimero Trulicina", icon: "üé≠‚ú®", cost: 45000, sell: 22500, income: 230, currency: "silver", description: "A magical spellcaster of nonsense words." },
                { name: "Bananita Dolphinita", icon: "üçåüê¨", cost: 50000, sell: 25000, income: 260, currency: "silver", description: "A banana carved into the shape of a dolphin." },
                { name: "Los Liritos", icon: "üé∂üë•", cost: 55000, sell: 27500, income: 300, currency: "silver", description: "A choir of small creatures singing off-key." },
                { name: "Salamino Pinguino", icon: "üå≠üêß", cost: 60000, sell: 30000, income: 340, currency: "silver", description: "A penguin made entirely of cured Italian meat." },
                { name: "Tric Trac Baraboom", icon: "‚è∞üí•", cost: 65000, sell: 32500, income: 380, currency: "silver", description: "A time-bomb ticking to a reggaeton beat." },
                { name: "Los Tung Tungcitos", icon: "ü•Åüë∂", cost: 70000, sell: 35000, income: 420, currency: "silver", description: "Junior drummers practicing for the morning patrol." },
                { name: "Tukanno Bananno", icon: "ü¶úüçå", cost: 75000, sell: 37500, income: 460, currency: "silver", description: "A toucan with a beak made of potassium." },
                { name: "Blueberrinni Octopussini", icon: "ü´êüêô", cost: 80000, sell: 40000, income: 500, currency: "silver", description: "An octopus that inks pure blueberry juice." },
                { name: "Spijuniro Golubiro", icon: "üïµÔ∏èüïäÔ∏è", cost: 85000, sell: 42500, income: 550, currency: "silver", description: "The secret agent pigeon monitoring the streets." },
                { name: "Blueberrini Tatticini", icon: "ü´êüë∂", cost: 90000, sell: 45000, income: 600, currency: "silver", description: "Tactical blueberries deployed for small ops." },
                { name: "Gingobalo Gingobali", icon: "üé™", cost: 95000, sell: 47500, income: 650, currency: "silver", description: "The nonsensical chant of the circus ringmaster." }
            ],
            "LEGENDARY": [
                { name: "Burbalona Loliloli", icon: "balloonüç≠", cost: 105000, sell: 52500, income: 750, currency: "silver", description: "A giant balloon fed on sugar and helium." },
                { name: "Chimpanzini Bananini", icon: "üêµüçå", cost: 120000, sell: 60000, income: 850, currency: "silver", description: "The primal ape who hoards all the bananas." },
                { name: "Ballerina Cappuccina", icon: "ü©∞‚òï", cost: 100000, sell: 50000, income: 500, currency: "silver", description: "A dancer fueled by a triple-shot latte." },
                { name: "Chef Crabracadabra", icon: "üßô‚Äç‚ôÇÔ∏è", cost: 200000, sell: 100000, income: 1000, currency: "silver", description: "A crab wizard who cooks with magic spells." },
                { name: "Glorbo Fruttodillo", icon: "üçé", cost: 300000, sell: 150000, income: 1500, currency: "silver", description: "An armadillo rolled up into a giant fruit." },
                { name: "Cacto Hipopotamo", icon: "üåµü¶õ", cost: 400000, sell: 200000, income: 2000, currency: "silver", description: "A hippo with a prickly defense mechanism." },
                { name: "Ballerino Lololo", icon: "ü©∞üé≠", cost: 500000, sell: 250000, income: 2500, currency: "silver", description: "The male lead dancer in the brainrot ballet." },
                { name: "Lerulerulerule", icon: "üìúüîÅ", cost: 600000, sell: 300000, income: 3000, currency: "silver", description: "The infinite tongue-twister that never ends." },
                { name: "Bambini Crostini", icon: "ü•ê", cost: 700000, sell: 350000, income: 3500, currency: "silver", description: "A small child wrapped in flaky pastry dough." },
                { name: "Fancescoo", icon: "üé©", cost: 800000, sell: 400000, income: 4000, currency: "silver", description: "A sophisticated gentleman shouting his own name." },
                { name: "Zibra Zubra Zibralini", icon: "ü¶ìüåÄ", cost: 900000, sell: 450000, income: 4500, currency: "silver", description: "A zebra with stripes that induce hypnosis." },
                { name: "Bambu di Miale", icon: "üéçüê∑", cost: 1000000, sell: 500000, income: 5000, currency: "silver", description: "A pig that hides perfectly inside bamboo." },
                { name: "Mangolini Parrocini", icon: "ü•≠", cost: 1200000, sell: 600000, income: 5500, currency: "silver", description: "A parrot camouflaged as a ripe mango." },
                { name: "Leonelli Cactuselli", icon: "ü¶Åüåµ", cost: 1500000, sell: 750000, income: 6000, currency: "silver", description: "The King of Beasts fused with a cactus." }
            ],
            "MYTHIC": [
                { name: "Frigo Camelo", icon: "<img src='https://storage.googleapis.com/msgsndr/ECv14A6vdkfO0uFvxGNG/media/695d001622afaa69eabffc61.jpg' class='w-full h-full object-cover rounded-md'>", cost: 1600000, sell: 800000, income: 6200, currency: "silver", description: "A camel with a refrigerator hump." },
                { name: "Orangutini Ananassini", icon: "ü¶ß Pineapple", cost: 1700000, sell: 850000, income: 6400, currency: "silver", description: "An orangutan made of pineapple chunks." },
                { name: "Bombardiro Crocodilo", icon: "<img src='https://storage.googleapis.com/msgsndr/ECv14A6vdkfO0uFvxGNG/media/69579de805b5113e1994a99a.jpg' class='w-full h-full object-cover rounded-md'>", cost: 1800000, sell: 900000, income: 6600, currency: "silver", description: "A crocodile strapped with heavy artillery." },
                { name: "Bombardini Gusini", icon: "<img src='https://storage.googleapis.com/msgsndr/ECv14A6vdkfO0uFvxGNG/media/69579dfc035c3a0de947a70d.jpg' class='w-full h-full object-cover rounded-md'>", cost: 1900000, sell: 950000, income: 6800, currency: "silver", description: "A goose that lays explosive eggs." },
                { name: "Gorillo Watermellondrillo", icon: "ü¶çüçâ", cost: 1950000, sell: 975000, income: 6900, currency: "silver", description: "A gorilla smashing a watermelon drill." },
                { name: "Sigma Boy", icon: "üòéüìà", cost: 2000000, sell: 1000000, income: 7000, goldIncome: 1, currency: "silver", description: "The mewing champion of the grindset." },
                { name: "Matteo", icon: "üë¶‚ú®", cost: 2200000, sell: 1100000, income: 7500, currency: "silver", description: "Just a regular guy named Matteo, but mythic." },
                { name: "Los Spijuniritos", icon: "üïµÔ∏èüë•", cost: 2400000, sell: 1200000, income: 8000, currency: "silver", description: "A network of tiny spy pigeons." },
                { name: "Rhino Toasterina", icon: "<img src='https://storage.googleapis.com/msgsndr/ECv14A6vdkfO0uFvxGNG/media/69579e17035c3a584547ae7d.jpg' class='w-full h-full object-cover rounded-md'>", cost: 2600000, sell: 1300000, income: 8500, currency: "silver", description: "A rhinoceros that doubles as a kitchen appliance." },
                { name: "Ganganzelli Trulala", icon: "üé≠üé∂", cost: 2800000, sell: 1400000, income: 9000, currency: "silver", description: "The masked singer of the brainrot opera." },
                { name: "Strawberrelli Famingelli", icon: "üçìüî•", cost: 3000000, sell: 1500000, income: 9500, currency: "silver", description: "A strawberry engulfed in mythic flames." },
                { name: "Elefantino Frigorifero", icon: "üêòüßä", cost: 3200000, sell: 1600000, income: 10000, currency: "silver", description: "An elephant that keeps your drinks cold." },
                { name: "To To To Sahur", icon: "ü•Åüåô", cost: 3500000, sell: 1750000, income: 11000, currency: "silver", description: "The triple-beat drum for waking the village." },
                { name: "Antoniooo", icon: "üë®‚Äçü¶±üì£", cost: 3800000, sell: 1900000, income: 12000, currency: "silver", description: "A man shouting his name into the void." },
                { name: "Te Te Te Sahur", icon: "ü•Åüåô", cost: 4100000, sell: 2050000, income: 13000, currency: "silver", description: "The high-pitched variant of the Sahur drum." },
                { name: "Perochello Lemonchello", icon: "üçêüçã", cost: 4400000, sell: 2200000, income: 14000, currency: "silver", description: "A zesty hybrid of pear and lemon liqueur." },
                { name: "Tang Tang Kelentang", icon: "ü•Åüîî", cost: 4700000, sell: 2350000, income: 15000, currency: "silver", description: "The clanging pots and pans of the morning." },
                { name: "Patapimus Maximus", icon: "üèõÔ∏è‚öîÔ∏è", cost: 5000000, sell: 2500000, income: 16000, currency: "silver", description: "The Roman General of rhythmic tapping." },
                { name: "Tirilikalika Tirilikalako", icon: "üé∂üîÅ", cost: 5500000, sell: 2750000, income: 18000, currency: "silver", description: "A catchy nonsense rhyme on loop." },
                { name: "Los Matteos", icon: "üë¶üë¶", cost: 6000000, sell: 3000000, income: 20000, currency: "silver", description: "Clones of Matteo taking over the world." }
            ],
            "BRAINROT_GOD": [
                { name: "Cocofanto Elefanto", icon: "ü••üêò", cost: 10000000, sell: 5000000, income: 25000, goldIncome: 1, currency: "silver", description: "An elephant made of coconut husk." },
                { name: "Tob Tobi Tob", icon: "üîÅüé≠", cost: 15000000, sell: 7500000, income: 30000, goldIncome: 5, currency: "silver", description: "The God of stuttering repetition." },
                { name: "Tralalero tralala", icon: "üé∂üåÄ", cost: 20000000, sell: 10000000, income: 35000, goldIncome: 25, currency: "silver", description: "A melody so old it predates time." },
                { name: "Odin Din Din Dun", icon: "üëÅÔ∏è", cost: 25000000, sell: 12500000, income: 40000, goldIncome: 50, currency: "silver", description: "The All-Father singing the dubi-dubi song." },
                { name: "Chachechi", icon: "üó£Ô∏è‚ú®", cost: 30000000, sell: 15000000, income: 45000, goldIncome: 150, currency: "silver", description: "The divine syllable speaker." },
                { name: "Espressona Signora", icon: "‚òïüë©", cost: 35000000, sell: 17500000, income: 50000, goldIncome: 300, currency: "silver", description: "The Lady of Espresso, jittering with power." },
                { name: "La Vaca Saturno Saturnita", icon: "ü™ê Cows Cows", cost: 40000000, sell: 20000000, income: 60000, goldIncome: 800, currency: "silver", description: "A cosmic cow grazing on Saturn's rings." },
                { name: "Centralucci Nuclearucci", icon: "‚ò¢Ô∏èüéØ", cost: 50000000, sell: 25000000, income: 75000, goldIncome: 1500, currency: "silver", description: "A living nuclear power plant." },
                { name: "Ecco Cavallo Virtuoso", icon: "üêéviolin", cost: 60000000, sell: 30000000, income: 90000, goldIncome: 2500, currency: "silver", description: "A horse that plays the violin perfectly." },
                { name: "Los Vaquitas Saturnitas", icon: "üêÆü™ê", cost: 75000000, sell: 37500000, income: 100000, goldIncome: 4000, currency: "silver", description: "The herd of space calves." },
                { name: "Bulbito Bandito Traktorito", icon: "üí°üöú", cost: 90000000, sell: 45000000, income: 120000, goldIncome: 8000, currency: "silver", description: "A tractor stealing lightbulbs." },
                { name: "Bananananito Bandito", icon: "üçåü¶π", cost: 120000000, sell: 60000000, income: 180000, goldIncome: 25000, currency: "silver", description: "The outlaw who stole the yellow fruit." },
                { name: "Chillin Chilli", icon: "‚ùÑÔ∏èüå∂Ô∏è", cost: 150000000, sell: 750000000, income: 200000, goldIncome: 40000, currency: "silver", description: "A spicy pepper wearing sunglasses." },
                { name: "Trippi Troppi Troppa Trippa", icon: "üçÑüåÄ", cost: 180000000, sell: 90000000, income: 250000, goldIncome: 60000, currency: "silver", description: "The ultimate hallucination." },
                { name: "Brri Bicus Dicus", icon: "ü™ÜüéÄ", cost: 200000000, sell: 100000000, income: 300000, goldIncome: 75000, currency: "silver", description: "A Russian doll containing the universe." },
                { name: "Cioccolatini Pancioncioni", icon: "üç´üç∞", cost: 250000000, sell: 125000000, income: 350000, goldIncome: 90000, currency: "silver", description: "God-tier chocolate for a God-tier belly." },
                { name: "Burr Es Teh Patipum", icon: "‚ùÑÔ∏èüí¢", cost: 300000000, sell: 150000000, income: 400000, goldIncome: 110000, currency: "silver", description: "Iced tea served with aggressive force." },
                { name: "Torrtuginni Dragonfruitinni", icon: "üê¢üêâ", cost: 350000000, sell: 175000000, income: 450000, goldIncome: 140000, currency: "silver", description: "A turtle shelled in dragonfruit skin." },
                { name: "Los Bros", icon: "üë¨üî•", cost: 400000000, sell: 200000000, income: 500000, goldIncome: 180000, currency: "silver", description: "The ultimate brotherhood of the rot." },
                { name: "Bambini Tankini", icon: "üë∂üõ¢Ô∏è", cost: 450000000, sell: 225000000, income: 550000, goldIncome: 220000, currency: "silver", description: "A baby driving an armored tank." },
                { name: "Jiqi Jiqi Shizhon", icon: "üßßüîÆ", cost: 500000000, sell: 250000000, income: 600000, goldIncome: 250000, currency: "silver", description: "The ancient fortune of the East." },
                { name: "Los Crocodillitos", icon: "üêäüë∂", cost: 600000000, sell: 300000000, income: 650000, goldIncome: 280000, currency: "silver", description: "A swarm of baby crocodiles." },
                { name: "Alessiooooooo", icon: "üë®‚Äçü¶±üì£", cost: 700000000, sell: 350000000, income: 700000, goldIncome: 310000, currency: "silver", description: "Alessio screaming louder than Antonio." },
                { name: "Karkerkar Kurkur", icon: "BNK", cost: 800000000, sell: 400000000, income: 750000, goldIncome: 330000, currency: "silver", description: "The sound of a bank vault closing." },
                { name: "Piccionetta Machina", icon: "üïäÔ∏è‚öôÔ∏è", cost: 900000000, sell: 450000000, income: 800000, goldIncome: 350000, currency: "silver", description: "A cyborg pigeon from the future." },
                { name: "Pipoqueira Motoqueira", icon: "üçøüèçÔ∏è", cost: 1000000000, sell: 500000000, income: 850000, goldIncome: 365000, currency: "silver", description: "Popcorn delivered by motorcycle." },
                { name: "Il Piccione Musculone", icon: "üí™", cost: 1100000000, sell: 550000000, income: 90000, goldIncome: 380000, currency: "silver", description: "A pigeon that hits the gym daily." },
                { name: "Job Job Job Sahur", icon: "ü•Åüßë‚Äçüíº", cost: 1200000000, sell: 600000000, income: 950000, goldIncome: 390000, currency: "silver", description: "The corporate worker waking up for Ramadan." },
                { name: "Las Sis", icon: "üëØ‚Äç‚ôÄÔ∏è‚ú®", cost: 1300000000, sell: 650000000, income: 1000000, goldIncome: 400000, currency: "silver", description: "The sisters who run the show." },
                { name: "Il Mastodontico Telepiedone Planetario", icon: "ü¶£ü™ê", cost: 1400000000, sell: 700000000, income: 1100000, goldIncome: 402000, currency: "silver", description: "A mammoth footprint the size of a planet." },
                { name: "Malame Amarale", icon: "üåä‚ù§Ô∏è", cost: 1500000000, sell: 750000000, income: 1200000, goldIncome: 404000, currency: "silver", description: "A tidal wave of emotion." },
                { name: "Belugelo Beluga", icon: " Whaleüêã‚ùÑÔ∏è", cost: 2000000000, sell: 1000000000, income: 1500000, goldIncome: 405000, currency: "silver", description: "The polite cat-whale of the internet." }
            ],
            "SECRET": [
                { name: "Los Tralaleritos", icon: "üé∂üë∂", cost: 2500000000, sell: 1250000000, income: 2000000, goldIncome: 450000, currency: "silver", description: "Tiny children humming the ancient song." },
                { name: "Las Tralaleritas", icon: "üé∂üëß", cost: 3000000000, sell: 1500000000, income: 2500000, goldIncome: 500000, currency: "silver", description: "Tiny girls humming the ancient melody." },
                { name: "Truenostruzzo Turbo 3000", icon: "‚ö°ü¶§", cost: 3500000000, sell: 1750000000, income: 3000000, goldIncome: 550000, currency: "silver", description: "A turbocharged ostrich breaker of sound barriers." },
                { name: "Kravilino Cekicino", icon: "crabsüî®", cost: 4000000000, sell: 2000000000, income: 3500000, goldIncome: 600000, currency: "silver", description: "A crab wielding a construction hammer." },
                { name: "Los Orcaleritos", icon: "üêãüë∂", cost: 4500000000, sell: 2250000000, income: 4000000, goldIncome: 650000, currency: "silver", description: "Baby killer whales in tuxedos." },
                { name: "Las Sis", icon: "üëØ‚Äç‚ôÄÔ∏è‚ú®", cost: 5000000000, sell: 2500000000, income: 4500000, goldIncome: 700000, currency: "silver", description: "The sisters return, shinier than before." },
                { name: "Piccione Macchina", icon: "üïäÔ∏èüöó", cost: 5500000000, sell: 2750000000, income: 5000000, goldIncome: 750000, currency: "silver", description: "A pigeon driving a sports car." },
                { name: "Peeling Peely", icon: "üòÑ", cost: 6000000000, sell: 3000000000, income: 5500000, goldIncome: 780000, currency: "silver", description: "The Fortnite banana revealing his true form." },
                { name: "Pakrahmatmamatcita", icon: "üßï‚ú®", cost: 6500000000, sell: 3250000000, income: 6000000, goldIncome: 790000, currency: "silver", description: "The matriarch of the neighborhood." },
                { name: "Pakrahmatmamat", icon: "üßïüì£", cost: 7000000000, sell: 3500000000, income: 650000, goldIncome: 795000, currency: "silver", description: "The patriarch announcing the news." },
                { name: "Treno Struzzo Turbo 4000", icon: "üöÜü¶§", cost: 8000000000, sell: 4000000000, income: 7000000, goldIncome: 798000, currency: "silver", description: "The ostrich has become a high-speed train." },
                { name: "Anpali Babel", icon: "üóºüåÄ", cost: 9000000000, sell: 4500000000, income: 800000, goldIncome: 800000, currency: "silver", description: "The tower where all brainrot languages mix." },
                { name: "Los Karkeritos", icon: "ü¶¥üë∂", cost: 10000000000, sell: 5000000000, income: 10000000, goldIncome: 1500000, currency: "silver", description: "Kids who love the sound of crunching bones." },
                { name: "Orcalero Orcala", icon: "üêãüé≠", cost: 12000000000, sell: 6000000000, income: 15000000, goldIncome: 5000000, currency: "silver", description: "The operatic singer of the deep sea." },
                { name: "Frogino Assassino", icon: "üê∏üó°Ô∏è", cost: 15000000000, sell: 7500000000, income: 20000000, goldIncome: 10000000, currency: "silver", description: "A ninja frog with a deadly tongue." },
                { name: "Ketchuru and Musturu", icon: "üçÖüü°", cost: 20000000000, sell: 10000000000, income: 25000000, goldIncome: 20000000, currency: "silver", description: "The twin deities of Ketchup and Mustard." },
                { name: "Pot Hotspot", icon: "üî•üì∂", cost: 25000000000, sell: 12500000000, income: 30000000, goldIncome: 25000000, currency: "silver", description: "A literal cooking pot emitting Wi-Fi." },
                { name: "Pot Hotspotina", icon: "üî•üì°", cost: 30000000000, sell: 15000000000, income: 35000000, goldIncome: 30000000, currency: "silver", description: "The female counterpart of the Wi-Fi pot." },
                { name: "21", icon: "üî¢‚ú®", cost: 35000000000, sell: 17500000000, income: 40000000, goldIncome: 35000000, currency: "silver", description: "What's nine plus ten? You know the answer." },
                { name: "Los Mobilis", icon: "üì±üë•", cost: 40000000000, sell: 20000000000, income: 45000000, goldIncome: 37000000, currency: "silver", description: "The legion of smartphone zombies." },
                { name: "Nooo My Hotspot", icon: "üò±üì∂", cost: 45000000000, sell: 22500000000, income: 50000000, goldIncome: 39000000, currency: "silver", description: "The tragic cry of losing internet connection." },
                { name: "Garamarama Dung Dung", icon: "drumsüí©", cost: 50000000000, sell: 25000000000, income: 55000000, goldIncome: 39500000, currency: "silver", description: "A drum beat so dirty it smells." },
                { name: "Pirulitoita Bicicleteira", icon: "lollipopüö≤", cost: 55000000000, sell: 27500000000, income: 60000000, goldIncome: 39800000, currency: "silver", description: "Riding a bicycle while eating a lollipop." },
                { name: "Il Sacro Cabrospaghetti", icon: "GOAT Spaghettiüçù", cost: 60000000000, sell: 30000000000, income: 65000000, goldIncome: 39900000, currency: "silver", description: "The holy goat tangled in pasta." },
                { name: "Chicleteirina Bicicleteirina", icon: "candyüö≤", cost: 65000000000, sell: 32500000000, income: 70000000, goldIncome: 39950000, currency: "silver", description: "Riding a bike while chewing bubblegum." },
                { name: "La Grande Combinacion", icon: "üß©üëë", cost: 100000000000, sell: 50000000000, income: 100000000, goldIncome: 40000000, currency: "silver", description: "The ultimate combo of all things brainrot." },
                { name: "Los Chicleteiras", icon: "candyüë•", cost: 200000000000, sell: 100000000000, income: 150000000, goldIncome: 1000000, currency: "silver", description: "The gum-chewing gang." },
                { name: "Le Golem De Frgider", icon: "üóøüßä", cost: 400000000000, sell: 200000000000, income: 200000000, goldIncome: 3000000, currency: "silver", description: "A monster constructed from kitchen fridges." },
                { name: "67", icon: "<img src='https://storage.googleapis.com/msgsndr/ECv14A6vdkfO0uFvxGNG/media/6957b492d350af3198a60faa.jpg' class='w-full h-full object-cover rounded-md'>", cost: 600000000000, sell: 300000000000, income: 300000000, goldIncome: 6700000, currency: "silver", description: "The sacred number of the Skibidi verse." },
                { name: "Los Esok Sekolitos", icon: "üè´üë∂", cost: 800000000000, sell: 400000000000, income: 400000000, goldIncome: 8000000, currency: "silver", description: "Kids dreading school tomorrow." },
                { name: "Coccoblade", icon: "ü••‚öîÔ∏è", cost: 1000000000000, sell: 500000000000, income: 500000000, goldIncome: 10000000, currency: "silver", description: "A sword forged from the hardest coconut." },
                { name: "Ketupat Kepat Prekupat", icon: "üçö‚ú®", cost: 2000000000000, sell: 1000000000000, income: 700000000, goldIncome: 14000000, currency: "silver", description: "A woven rice cake vibrating with energy." },
                { name: "Dul Dul Dul", icon: "lollipopüîÅ", cost: 2500000000000, sell: 1250000000000, income: 800000000, goldIncome: 16000000, currency: "silver", description: "The infinite lick of the candy." },
                { name: "W and L", icon: "üèÜüíÄ", cost: 3000000000000, sell: 1500000000000, income: 900000000, goldIncome: 17000000, currency: "silver", description: "The balance of Wins and Losses." },
                { name: "Los Garamdungcitos", icon: "drumsüë∂", cost: 3500000000000, sell: 1750000000000, income: 1000000000, goldIncome: 18000000, currency: "silver", description: "Little drummers beating the salt drums." },
                { name: "Lirili Railu", icon: "üé∂üöÜ", cost: 4000000000000, sell: 2000000000000, income: 1100000000, goldIncome: 19000000, currency: "silver", description: "The musical train to nowhere." },
                { name: "La Esok Sekolah", icon: "üè´üìö", cost: 4500000000000, sell: 2250000000000, income: 1200000000, goldIncome: 20000000, currency: "silver", description: "The impending doom of going to school." },
                { name: "Pitiata Baem", icon: "üéâüí•", cost: 5000000000000, sell: 2500000000000, income: 1300000000, goldIncome: 22000000, currency: "silver", description: "A pi√±ata that hits you back." },
                { name: "Chimpanzini Kingini", icon: "üêµüëë", cost: 6000000000000, sell: 3000000000000, income: 1500000000, goldIncome: 25000000, currency: "silver", description: "The King Kong of the memes." },
                { name: "Strawberry Elephant", icon: "<img src='https://storage.googleapis.com/msgsndr/ECv14A6vdkfO0uFvxGNG/media/69579e217483030cb59e69bc.jpg' class='w-full h-full object-cover rounded-md'>", cost: 7000000000000, sell: 3500000000000, income: 1800000000, goldIncome: 28000000, currency: "silver", description: "The red pachyderm famous for AI song covers." },
                { name: "Klombo", icon: "dinosaurs", cost: 8000000000000, sell: 4000000000000, income: 2000000000, goldIncome: 30000000, currency: "silver", description: "The friendly, berry-eating Fortnite dinosaur." },
                { name: "Shtekerito el Bulbonito", icon: "üîåüí°", cost: 9000000000000, sell: 4500000000000, income: 2200000000, goldIncome: 35000000, currency: "silver", description: "The electric plug that powers the memes." },
                { name: "Spaghetti Tualetti", icon: "üçùüöΩ", cost: 10000000000000, sell: 5000000000000, income: 2500000000, goldIncome: 40000000, currency: "silver", description: "Pasta served in the Skibidi bowl." },
                { name: "Cabritos Brotheritos", icon: "GOAT Spaghettiüçù", cost: 12000000000000, sell: 6000000000000, income: 3000000000, goldIncome: 50000000, currency: "silver", description: "The brother goats." },
                { name: "La Crazy Combinacion", icon: "ü§™üß©", cost: 16000000000000, sell: 8000000000000, income: 4000000000, goldIncome: 70000000, currency: "silver", description: "A combination so wild it breaks the game." },
                { name: "Gigalitraktos Spidorobos", icon: "üöúü§ñ", cost: 18000000000000, sell: 9000000000000, income: 4500000000, goldIncome: 80000000, currency: "silver", description: "A tractor spider robot destroyer." },
                { name: "Garbagezilla", icon: "üóëÔ∏èRex", cost: 20000000000000, sell: 10000000000000, income: 5000000000, goldIncome: 100000000, currency: "silver", description: "Kaiju monster formed from pure trash." },
                { name: "Cannone Maldettone", icon: "üî´üòà", cost: 25000000000000, sell: 12500000000000, income: 6000000000, goldIncome: 150000000, currency: "silver", description: "The cursed cannon that fires regret." }
            ],
            "GOAT": [
                { name: "Skibidi Toilet", icon: "üöΩüé∂", cost: 1000000000000, sell: 500000000000, income: 10000000000, goldIncome: 200000000, currency: "gold", description: "The head in the toilet that started the war." },
                { name: "Meowl Meowl", icon: "<img src='https://storage.googleapis.com/msgsndr/ECv14A6vdkfO0uFvxGNG/media/69579df5e7c6137a015f9dd3.jpg' class='w-full h-full object-cover rounded-md'>", cost: 3000000000000, sell: 1500000000000, income: 20000000000, goldIncome: 500000000, currency: "gold", description: "The Billie Eilish cat meme crying for help." },
                { name: "Cococita Bailacita", icon: "coconutüíÉ", cost: 5000000000000, sell: 2500000000000, income: 40000000000, goldIncome: 1000000000, currency: "gold", description: "The dancing coconut lady." },
                { name: "Rascalito Razzalito", icon: "raccoonüí•", cost: 6000000000000, sell: 3000000000, income: 6000000000, goldIncome: 1200000000, currency: "gold", description: "Pedro the Raccoon spinning in a circle." },
                { name: "Ese Vato Gato", icon: "üòéüêà", cost: 8000000000, sell: 4000000000000, income: 8000000000, goldIncome: 2000000000, currency: "gold", description: "That cool cat dude wearing shades." },
                { name: "Brainrot Collector", icon: "üëëüß†", cost: 10000000000000, sell: 5000000000000, income: 100000000000, goldIncome: 5000000000, currency: "gold", description: "You. The one collecting all this madness." }
            ]
        };

        var audioLib = {
            draw: new Audio('https://www.myinstants.com/media/sounds/teleport-sound-effect.mp3'), 
            pop: new Audio('https://actions.google.com/sounds/v1/cartoon/pop.ogg'),
            laser: new Audio('https://actions.google.com/sounds/v1/science_fiction/laser_gun_shot.ogg'),
            thunder: new Audio('https://actions.google.com/sounds/v1/weather/thunder_crack.ogg'),
            boom: new Audio('https://www.myinstants.com/media/sounds/vine-boom.mp3'), 
            heaven: new Audio('https://actions.google.com/sounds/v1/cartoon/harp_strum.ogg'),
            rolling: new Audio('https://www.soundjay.com/misc/sounds/slot-machine-wheel-1.mp3'),
            ching: new Audio('https://www.myinstants.com/media/sounds/ka-ching.mp3'),
            buy: new Audio('https://www.myinstants.com/media/sounds/ka-ching.mp3'),
            sell: new Audio('https://www.myinstants.com/media/sounds/coin.mp3'),
            shutter: new Audio('https://www.myinstants.com/media/sounds/camera-shutter-click-03.mp3'), 
            ambience: new Audio('https://actions.google.com/sounds/v1/crowds/battle_crowd_celebrate.ogg'), 
            wow: new Audio('https://www.myinstants.com/media/sounds/wow-11.mp3'), 
            elevator: new Audio('https://storage.googleapis.com/msgsndr/ECv14A6vdkfO0uFvxGNG/media/695cc4ee4a5e8e56d6295516.mp3'), 
            disco: new Audio('https://storage.googleapis.com/msgsndr/ECv14A6vdkfO0uFvxGNG/media/695cc9d8993346331a35dec3.mp3'),
            glitch: new Audio('https://brainrotcollector.com/audio/glitch.mp3')
        };
        
        audioLib.ambience.loop = true;
        audioLib.ambience.volume = 0.4;
        audioLib.wow.volume = 0.6;
        audioLib.elevator.loop = true;
        audioLib.elevator.volume = 0.3;
        audioLib.disco.loop = true;
        audioLib.disco.volume = 0.4;
        audioLib.glitch.loop = true;

        // --- HELPER FOR STARS ---
        function getStarHTML(count, className = '') {
            let stars = '';
            // Visual Balance Logic:
            // 3: 1 top, 2 bottom
            // 4: 2 top, 2 bottom (staggered left)
            // 5: 2 top, 3 bottom (top centered)
            // 6: 3 top, 3 bottom (staggered left)
            // 7: 3 top, 4 bottom
            // 8: 4 top, 4 bottom (staggered left)
            // 9: 4 top, 5 bottom
            
            if (count === 3) stars = '‚òÖ<br>‚òÖ‚òÖ';
            else if (count === 4) stars = '‚òÖ‚òÖ&nbsp;<br>‚òÖ‚òÖ';
            else if (count === 5) stars = '‚òÖ‚òÖ<br>‚òÖ‚òÖ‚òÖ';
            else if (count === 6) stars = '‚òÖ‚òÖ‚òÖ&nbsp;<br>‚òÖ‚òÖ‚òÖ';
            else if (count === 7) stars = '‚òÖ‚òÖ‚òÖ<br>‚òÖ‚òÖ‚òÖ‚òÖ';
            else if (count === 8) stars = '‚òÖ‚òÖ‚òÖ‚òÖ&nbsp;<br>‚òÖ‚òÖ‚òÖ‚òÖ';
            else if (count === 9) stars = '‚òÖ‚òÖ‚òÖ‚òÖ<br>‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ';
            else {
                for(let i=0; i<count; i++) { stars += '‚òÖ'; }
            }
            
            // Flex column to stack rows, centered text
            return `<div class="star-rating ${className} !flex !flex-col !items-center !justify-center !gap-0 !leading-[0.85] text-center" style="text-shadow: 1px 1px 0 #000;">
                        <span>${stars}</span>
                    </div>`;
        }

        function toggleAdminPanelUI() {
            const panel = document.getElementById('admin-panel');
            panel.classList.toggle('active');
            playSound('pop');
        }

        function toggleInventory() {
            const menu = document.getElementById('inventory-menu');
            if (menu.classList.contains('hidden')) {
                menu.classList.remove('hidden');
                setTimeout(() => {
                    menu.classList.remove('opacity-0');
                }, 10);
            } else {
                menu.classList.add('hidden');
            }
            playSound('pop');
        }

        function activateGlitchMode() {
            if (document.body.classList.contains('glitch-mode-active')) return;
            
            playSound('glitch');
            document.body.classList.add('glitch-mode-active');
            
            // Duration: 2 minutes and 22 seconds = 142000ms
            const duration = 142000;
            applyLuckBonus(5, duration); 

            setTimeout(() => {
                document.body.classList.remove('glitch-mode-active');
                audioLib.glitch.pause();
                audioLib.glitch.currentTime = 0;
                if (activeTimeBonus.endTime <= Date.now() + 100) {
                    applyLuckBonus(1, 0);
                }
            }, duration);
        }

        function triggerTifaRush() {
            const rushModal = document.createElement('div');
            rushModal.className = 'fixed inset-0 z-[200] flex items-center justify-center pointer-events-none';
            rushModal.innerHTML = `<div class="animate-bounce text-9xl relative z-10 filter drop-shadow-[0_0_20px_#ff0055]">ü•ä</div><div class="absolute inset-0 bg-red-500/20 animate-pulse mix-blend-overlay"></div><h1 class="absolute mt-40 text-white font-black text-6xl md:text-8xl drop-shadow-[0_0_20px_#ff0055] animate-ping whitespace-nowrap">TIFA RUSH!</h1>`;
            document.body.appendChild(rushModal); 
            playSound('heaven'); 
            applyLuckBonus(10, 30000); // 10x luck for 30s
            setTimeout(() => { rushModal.remove(); }, 3000);
        }

        function toggleAdminAbuse() {
            const section = document.getElementById('admin-section');
            section.scrollIntoView({ behavior: 'smooth' });
            playSound('thunder');
        }

        function unlockAllMaxxers() {
            Object.keys(MAXXER_REWARDS).forEach(r => rewards[r] = true);
            updateStatsUI();
            playSound('wow');
        }

        function playSound(name) {
            const sound = audioLib[name];
            if (sound) { 
                if (name !== 'ambience' && name !== 'elevator' && name !== 'disco' && name !== 'glitch') {
                    sound.currentTime = 0; 
                }
                if(name === 'shutter') sound.volume = 0.4;
                sound.play().catch(e => {}); 
            }
        }

        function spawnFirework(container, isFullScreen = false) {
            if(!container) return;
            const x = Math.random() * 100; 
            const minY = isFullScreen ? 10 : 10;
            const maxY = isFullScreen ? 80 : 50;
            const y = Math.random() * (maxY - minY) + minY;
            const color = `hsl(${Math.random() * 360}, 100%, 70%)`;
            const particles = 12;

            const center = document.createElement('div');
            center.className = 'absolute w-2 h-2 rounded-full bg-white blur-sm animate-ping';
            center.style.left = x + '%';
            center.style.top = y + '%';
            center.style.backgroundColor = color;
            container.appendChild(center);
            setTimeout(() => center.remove(), 500);

            for (let i = 0; i < particles; i++) {
                const p = document.createElement('div');
                p.className = 'firework-particle';
                p.style.backgroundColor = color;
                p.style.boxShadow = `0 0 6px ${color}`;
                p.style.left = x + '%';
                p.style.top = y + '%';
                const angle = (i / particles) * 360; 
                const velocity = Math.random() * 60 + 40; 
                const scale = isFullScreen ? 1.5 : 1;
                const tx = (Math.cos(angle * Math.PI / 180) * velocity * scale) + 'px';
                const ty = (Math.sin(angle * Math.PI / 180) * velocity * scale) + 'px';
                p.style.setProperty('--tx', tx);
                p.style.setProperty('--ty', ty);
                container.appendChild(p);
                setTimeout(() => p.remove(), 1000);
            }
        }

        function toggleMusic() {
            const music = audioLib.elevator;
            const btn = document.getElementById('music-btn');
            const pullBtn = document.getElementById('pull-btn');
            const gameBox = document.getElementById('main-game-box');
            const carpetContainer = document.getElementById('rot-history').parentElement;
            const carpetList = document.getElementById('rot-history');

            if (music.paused) {
                if (!audioLib.disco.paused) toggleDisco();
                music.play().catch(e => console.log("Audio play failed", e));
                document.body.classList.add('lantern-festival-theme-active');
                btn.classList.add('ring-2', 'ring-orange-400', 'shadow-[0_0_25px_orange]', 'bg-orange-500', 'text-white');
                btn.classList.remove('bg-indigo-900/20', 'text-white/40');
                btn.style.filter = "brightness(1.5) drop-shadow(0 0 5px gold)";
                
                if (!liveRollInterval) {
                    toggleLiveRoll();
                }
                
                if (pullBtn) {
                    pullBtn.disabled = true;
                    const span = pullBtn.querySelector('span');
                    if (span) span.innerText = "LANTERN FESTIVAL";
                    else pullBtn.innerText = "LANTERN FESTIVAL";
                }

                if(carpetContainer) {
                    const darkOverlay = document.createElement('div');
                    darkOverlay.id = 'lantern-festival-dark-overlay';
                    darkOverlay.className = 'lantern-festival-overlay';
                    carpetContainer.appendChild(darkOverlay);
                    const neonOverlay = document.createElement('div');
                    neonOverlay.id = 'lantern-festival-neon-overlay';
                    neonOverlay.className = 'lantern-festival-neon-overlay';
                    carpetContainer.appendChild(neonOverlay);
                    const glitterOverlay = document.createElement('div');
                    glitterOverlay.id = 'lantern-festival-glitter-overlay';
                    glitterOverlay.className = 'lantern-festival-glitter';
                    carpetContainer.appendChild(glitterOverlay);
                    const fwContainer = document.createElement('div');
                    fwContainer.id = 'lantern-festival-fireworks';
                    fwContainer.className = 'absolute inset-0 pointer-events-none z-20 overflow-hidden';
                    carpetContainer.appendChild(fwContainer);
                    fireworksInterval = setInterval(() => { spawnFirework(fwContainer, false); }, 800); 
                    const fsFwContainer = document.createElement('div');
                    fsFwContainer.id = 'lantern-festival-fs-fireworks';
                    fsFwContainer.className = 'fixed inset-0 pointer-events-none z-50 overflow-hidden';
                    document.body.appendChild(fsFwContainer);
                    fsFireworksInterval = setInterval(() => { spawnFirework(fsFwContainer, true); }, 1000); 
                }
                if(gameBox) {
                    const lampContainer = document.createElement('div');
                    lampContainer.id = 'lantern-festival-lamps';
                    lampContainer.className = 'absolute top-[100%] left-0 w-full pointer-events-none z-40 flex justify-around items-start px-8';
                    for(let i=0; i<6; i++) {
                        const lampWrapper = document.createElement('div');
                        lampWrapper.className = 'flex flex-col items-center animate-float'; 
                        lampWrapper.style.animationDuration = (3 + Math.random()) + 's'; 
                        const wire = document.createElement('div');
                        wire.className = 'w-0.5 h-12 bg-black/80';
                        const lamp = document.createElement('div');
                        lamp.className = 'text-xl animate-lantern-glow -mt-1';
                        lamp.innerHTML = 'üèÆ';
                        lampWrapper.appendChild(wire);
                        lampWrapper.appendChild(lamp);
                        lampContainer.appendChild(lampWrapper);
                    }
                    gameBox.appendChild(lampContainer);
                }
                if(carpetList) { carpetList.classList.add('lantern-festival-mode-active'); }
            } else {
                music.pause();
                document.body.classList.remove('lantern-festival-theme-active');
                btn.classList.remove('ring-2', 'ring-orange-400', 'shadow-[0_0_25px_orange]', 'bg-orange-500', 'text-white');
                btn.classList.add('bg-indigo-900/20', 'text-white/40');
                btn.style.filter = "none";
                
                if (liveRollInterval) {
                    toggleLiveRoll();
                }

                if (pullBtn) {
                    pullBtn.disabled = false;
                    const span = pullBtn.querySelector('span');
                    if (span) span.innerText = "DRAW AGAIN";
                    else pullBtn.innerText = "DRAW AGAIN";
                }

                const dark = document.getElementById('lantern-festival-dark-overlay'); if(dark) dark.remove();
                const neon = document.getElementById('lantern-festival-neon-overlay'); if(neon) neon.remove();
                const glitter = document.getElementById('lantern-festival-glitter-overlay'); if(glitter) glitter.remove();
                const lamps = document.getElementById('lantern-festival-lamps'); if(lamps) lamps.remove();
                const fws = document.getElementById('lantern-festival-fireworks'); if(fws) fws.remove();
                const fsFws = document.getElementById('lantern-festival-fs-fireworks'); if(fsFws) fsFws.remove();
                if (fireworksInterval) { clearInterval(fireworksInterval); fireworksInterval = null; }
                if (fsFireworksInterval) { clearInterval(fsFireworksInterval); fsFireworksInterval = null; }
                if(carpetList) { carpetList.classList.remove('lantern-festival-mode-active'); }
            }
            lucide.createIcons();
        }

        function toggleDisco() {
            const music = audioLib.disco;
            const btn = document.getElementById('disco-btn');
            const pullBtn = document.getElementById('pull-btn');
            const bgTokyo = document.getElementById('bg-tokyo');
            const bgDisco = document.getElementById('bg-disco');
            const carpetContainer = document.getElementById('rot-history').parentElement;
            
            if (music.paused) {
                if (!audioLib.elevator.paused) toggleMusic();
                music.play().catch(e => console.log("Audio play failed", e));
                btn.classList.add('animate-disco', 'ring-2', 'ring-purple-400', 'bg-purple-600', 'text-white');
                btn.classList.remove('bg-purple-600/20', 'text-white/40');
                document.body.classList.add('rainbow-mode-active'); 
                
                if (!liveRollInterval) {
                    toggleLiveRoll();
                }
                
                if (pullBtn) {
                    pullBtn.disabled = true;
                    const span = pullBtn.querySelector('span');
                    if (span) span.innerText = "RAINBOW MODE ACTIVE";
                    else pullBtn.innerText = "RAINBOW MODE ACTIVE";
                }

                if(bgTokyo) bgTokyo.classList.replace('opacity-60', 'opacity-0');
                if(bgDisco) bgDisco.classList.replace('opacity-0', 'opacity-60');
                if(carpetContainer) {
                    const lights = document.createElement('div');
                    lights.id = 'disco-lights-overlay';
                    lights.className = 'disco-overlay';
                    carpetContainer.appendChild(lights);
                }
                const globalBorder = document.getElementById('rainbow-border-overlay');
                if (globalBorder) document.body.appendChild(globalBorder);
            } else {
                music.pause();
                btn.classList.remove('animate-disco', 'ring-2', 'ring-purple-400', 'bg-purple-600', 'text-white');
                btn.classList.add('bg-purple-600/20', 'text-white/40');
                document.body.classList.remove('rainbow-mode-active'); 
                
                if (liveRollInterval) {
                    toggleLiveRoll();
                }

                if (pullBtn) {
                    pullBtn.disabled = false;
                    const span = pullBtn.querySelector('span');
                    if (span) span.innerText = "DRAW AGAIN";
                    else pullBtn.innerText = "DRAW AGAIN";
                }

                if(bgTokyo) bgTokyo.classList.replace('opacity-0', 'opacity-60');
                if(bgDisco) bgDisco.classList.replace('opacity-60', 'opacity-0');
                const lights = document.getElementById('disco-lights-overlay'); if(lights) lights.remove();
                const globalBorder = document.getElementById('rainbow-border-overlay'); if(globalBorder) globalBorder.remove();
            }
        }

        function formatNumber(num) {
            if (num < 1000) return Math.floor(num);
            const suffixes = [
                { val: 1e27, suffix: 'Oct' }, { val: 1e24, suffix: 'Se' }, { val: 1e21, suffix: 'Si' },
                { val: 1e18, suffix: 'C' }, { val: 1e15, suffix: 'Q' }, { val: 1e12, suffix: 'T' },
                { val: 1e9, suffix: 'B' }, { val: 1e6, suffix: 'M' }, { val: 1e3, suffix: 'K' }
            ];
            for (let i = 0; i < suffixes.length; i++) {
                if (num >= suffixes[i].val) {
                    return (num / suffixes[i].val).toFixed(2).replace(/\.00$/, '') + suffixes[i].suffix;
                }
            }
            return num;
        }

        function showGlobalBroadcast(itemName, color) {
            const container = document.getElementById('broadcast-container');
            if(!container) return;
            const broadcast = document.createElement('div');
            broadcast.className = 'bg-black/90 border-2 rounded-lg p-3 shadow-[0_0_15px_rgba(0,0,0,0.5)] flex items-center gap-3 broadcast-msg relative overflow-hidden';
            broadcast.style.borderColor = color;
            broadcast.innerHTML = `
                <div class="flex items-center gap-2 brand-font font-black italic text-[10px] md:text-xs tracking-tighter uppercase">
                    <span class="bg-red-600 text-white px-2 py-0.5 rounded-sm animate-pulse">SYSTEM</span>
                    <span class="text-white">Someone collected</span>
                    <span style="color:${color}" class="drop-shadow-[0_0_5px_${color}]">${itemName}</span>
                </div>
                <div class="absolute inset-0 bg-white/5 pointer-events-none animate-pulse"></div>
            `;
            container.appendChild(broadcast);
            setTimeout(() => broadcast.remove(), 4500);
        }

        function updateStatsUI() {
            const vals = [currencies.silver, currencies.gold, currencies.stars, currencies.diamonds, currencies.moonstones];
            ['silver', 'gold', 'star', 'diamond', 'moonstone'].forEach((k, i) => {
                const el = document.getElementById(k + '-count-display'); if(el) el.innerText = formatNumber(vals[i]);
            });
            ['silver', 'gold', 'stars', 'diamonds', 'moonstones'].forEach((k, i) => {
                const el = document.getElementById('h-' + k); 
                if(el) {
                    let icon = '';
                    if (i === 0) icon = SILVER_ICON_HTML;
                    else if (i === 1) icon = GOLD_ICON_HTML;
                    else if (i === 4) icon = MOONSTONE_ICON_HTML;
                    else icon = ['üîò', 'ü™ô', 'üåü', 'üíé', 'ü™®'][i];
                    el.innerHTML = `${icon} ${formatNumber(vals[i])}`;
                }
            });

            const isCrystalMax = (currencies.powerCrystals || 0) >= 100;
            const pcEl = document.getElementById('h-power-crystals');
            if (pcEl) {
                pcEl.innerHTML = `üîÆ ${currencies.powerCrystals || 0}/100`;
                if (isCrystalMax) pcEl.classList.add('crystal-max-glow');
                else pcEl.classList.remove('crystal-max-glow');
            }
            const pcStashEl = document.getElementById('power-crystal-count-display');
            if (pcStashEl) {
                pcStashEl.innerText = `${currencies.powerCrystals || 0}/100`;
                const stashContainer = document.getElementById('power-crystal-stash-container');
                if (stashContainer) {
                    if (isCrystalMax) stashContainer.classList.add('crystal-max-glow');
                    else stashContainer.classList.remove('crystal-max-glow');
                }
            }
            
            const silverContainers = document.querySelectorAll('.silver-img-container');
            silverContainers.forEach(container => { container.innerHTML = SILVER_ICON_HTML; });
            const moonstoneContainers = document.querySelectorAll('.moonstone-img-container');
            moonstoneContainers.forEach(container => { container.innerHTML = MOONSTONE_ICON_HTML; });

            const stashSilverIcon = document.getElementById('stash-silver-icon');
            if(stashSilverIcon) stashSilverIcon.innerHTML = SILVER_ICON_HTML;
            const stashMoonstoneIcon = document.getElementById('stash-moonstone-icon');
            if(stashMoonstoneIcon) stashMoonstoneIcon.innerHTML = MOONSTONE_ICON_HTML;

            const pendingDisplay = document.getElementById('pending-silver-display');
            const globalCollectBtn = document.getElementById('global-collect-btn');
            
            if (pendingDisplay) {
                let pendingText = "";
                if (accumulatedSilver > 0) pendingText += `${formatNumber(accumulatedSilver)} ${SILVER_ICON_HTML}\n`;
                if (accumulatedGold > 0) pendingText += `${formatNumber(accumulatedGold)} ${GOLD_ICON_HTML}`;
                if (pendingText === "") pendingText = `0 ${SILVER_ICON_HTML}`;
                pendingDisplay.innerHTML = pendingText;
            }

            const isIncomeWaiting = accumulatedSilver > 0 || accumulatedGold > 0;
            if (globalCollectBtn) {
                if (isIncomeWaiting) globalCollectBtn.classList.add('quick-collect-active');
                else globalCollectBtn.classList.remove('quick-collect-active');
            }

            const silverRate = baseInventory.reduce((total, item) => total + (item && (item.currency === 'silver' || !item.currency) ? (item.income || 0) : 0), 0);
            const goldRate = baseInventory.reduce((total, item) => total + (item && item.goldIncome ? (item.goldIncome || 0) : 0), 0);
            const rateDisplay = document.getElementById('rate-display');
            if (rateDisplay) {
                let rateText = "";
                if (silverRate > 0) rateText += `${formatNumber(silverRate)} ${SILVER_ICON_HTML}`;
                if (silverRate > 0 && goldRate > 0) rateText += " + ";
                if (goldRate > 0) rateText += `${formatNumber(goldRate)} ${GOLD_ICON_HTML}`;
                if (rateText === "") rateText = "0";
                rateDisplay.innerHTML = rateText;
            }

            const maxxerContainer = document.getElementById('maxxers-container');
            if(maxxerContainer) {
                maxxerContainer.innerHTML = '';
                bonusBaseLuck = 0;
                Object.keys(MAXXER_REWARDS).forEach(rarity => {
                    const data = MAXXER_REWARDS[rarity];
                    const isEarned = rewards[rarity] === true;
                    if (isEarned) bonusBaseLuck += 1;
                    
                    const badge = document.createElement('div');
                    badge.className = `w-14 h-14 md:w-16 md:h-16 flex flex-col items-center justify-center rounded-xl border-2 maxxer-badge ${isEarned ? 'opacity-100 scale-100' : 'opacity-10 scale-90'}`;
                    badge.style.borderColor = isEarned ? data.color : '#333';
                    badge.style.background = isEarned ? 'rgba(0,0,0,0.8)' : 'transparent';
                    badge.title = isEarned ? `${data.name} (+1 Base Luck)` : 'LOCKED';
                    badge.innerHTML = `<span class="text-2xl md:text-3xl">${isEarned ? data.icon : 'üîí'}</span>`;
                    maxxerContainer.appendChild(badge);
                });
            }

            const upgradesContainer = document.getElementById('innate-upgrades-container');
            if(upgradesContainer) {
                upgradesContainer.innerHTML = '';
                if(inventory.upgrades.expander1) {
                    upgradesContainer.innerHTML += `<div class="w-16 h-16 flex items-center justify-center bg-cyan-900/30 border-2 border-cyan-400 rounded-xl animate-pulse text-3xl shadow-[0_0_15px_cyan]" title="Base Expander I (+5 Slots)">üèóÔ∏è</div>`;
                }
                if(inventory.upgrades.expander2) {
                    upgradesContainer.innerHTML += `<div class="w-16 h-16 flex items-center justify-center bg-cyan-900/30 border-2 border-cyan-400 rounded-xl animate-pulse text-3xl shadow-[0_0_15px_cyan]" title="Base Expander II (+5 Slots)">üèôÔ∏è</div>`;
                }
            }

            const luckValEl = document.getElementById('bonus-luck-val');
            if (luckValEl) luckValEl.innerText = (1 + bonusBaseLuck + (isAutoFestivalActive || isAutoRainbowActive ? 1 : 0));

            if(inventory.upgrades.expander1) {
                const btn1 = document.getElementById('btn-expander-1');
                if(btn1) { btn1.innerText = "OWNED"; btn1.disabled = true; btn1.classList.add('bg-green-600', 'text-white'); btn1.classList.remove('bg-gray-200', 'text-black'); }
            }
            if(inventory.upgrades.expander2) {
                const btn2 = document.getElementById('btn-expander-2');
                if(btn2) { btn2.innerText = "OWNED"; btn2.disabled = true; btn2.classList.add('bg-green-600', 'text-white'); btn2.classList.remove('bg-yellow-600'); }
            }

            renderBaseUI();
            
            const gl = document.getElementById('game-lucky-count'); if(gl) gl.innerText = inventory.lucky;
            const gg = document.getElementById('game-grand-count'); if(gg) gg.innerText = inventory.grand;
            const gc = document.getElementById('game-crazy-count'); if(gc) gc.innerText = inventory.crazy;

            renderInventory('inv-lucky', inventory.lucky, 'üéüÔ∏è', 'lucky');
            renderInventory('inv-grand', inventory.grand, 'üéü', 'grand');
            renderInventory('inv-crazy', inventory.crazy, 'üéÅ', 'crazy');

            const b2 = document.getElementById('base-bonus-2'); if(b2) b2.innerText = `x${inventory.timeBonus.x2}`;
            const b4 = document.getElementById('base-bonus-4'); if(b4) b4.innerText = `x${inventory.timeBonus.x4}`;
            const b10 = document.getElementById('base-bonus-10'); if(b10) b10.innerText = `x${inventory.timeBonus.x10}`;
            const b20 = document.getElementById('base-bonus-20'); if(b20) b20.innerText = `x${inventory.timeBonus.x20}`;
            const sg = document.getElementById('menu-count-god'); if(sg) sg.innerText = `x${inventory.special.god}`;
            const ss = document.getElementById('menu-count-secret'); if(ss) ss.innerText = `x${inventory.special.secret}`;
            const sgo = document.getElementById('menu-count-goat'); if(sgo) sgo.innerText = `x${inventory.special.goat}`;
            const su = document.getElementById('menu-count-ultimate'); if(su) su.innerText = `x${inventory.special.ultimate}`;
            const sa = document.getElementById('menu-count-admin'); if(sa) sa.innerText = `x${inventory.special.admin}`;
        }

        function purchaseUpgrade(id, cost, currency = 'silver') {
            if(inventory.upgrades[id]) return;
            if(currencies[currency] >= cost) {
                currencies[currency] -= cost;
                inventory.upgrades[id] = true;
                const newSize = getMaxBaseSlots();
                while(baseInventory.length < newSize) baseInventory.push(null);
                playSound('buy');
                playSound('heaven');
                updateStatsUI();
                saveGame();
            }
        }

        function renderBaseUI() {
            const grid = document.getElementById('base-grid'); if(!grid) return;
            grid.innerHTML = '';
            const maxSlots = getMaxBaseSlots();
            for(let i=0; i<maxSlots; i++) {
                const slot = document.createElement('div');
                const item = baseInventory[i];
                slot.className = `base-slot ${item ? 'filled' : ''}`;
                if(item) {
                    const tier = tierConfig.find(t => t.id === item.tierId) || { stars: 1, name: item.tierName || 'COMMON' };
                    slot.innerHTML = item.icon + getStarHTML(tier.stars, 'collection-stars');
                    slot.style.borderColor = item.tierColor;
                    slot.title = item.name;
                    slot.onclick = () => showLoreModal(item, tier, i);
                } else { slot.innerHTML = '<span class="opacity-10 text-xs">EMPTY</span>'; }
                grid.appendChild(slot);
            }
        }

        function promptAddToBase(item, tier, uniqueId) {
            const dbItem = (itemDatabase[tier.id] || []).find(i => i.name === item.name) || item;
            pendingBaseItem = { 
                ...item, tierColor: tier.borderColor, tierName: tier.name, tierId: tier.id,
                cost: dbItem.cost || 1, currency: dbItem.currency || 'silver', sell: dbItem.sell || 1,
                income: dbItem.income || 1, goldIncome: dbItem.goldIncome || 0, type: dbItem.type || 'character', currencyType: dbItem.currencyType,
                bonusType: dbItem.bonusType, specialType: dbItem.specialType, luckyType: dbItem.luckyType, value: dbItem.value
            };
            pendingItemUniqueId = uniqueId; 
            const m = document.getElementById('base-prompt-modal'), c = document.getElementById('base-prompt-content');
            document.getElementById('prompt-icon').innerHTML = `<div class="relative inline-block">${item.icon}${getStarHTML(tier.stars || 1, 'draw-stars')}</div>`;
            document.getElementById('prompt-name').innerText = item.name;
            const promptText = document.getElementById('prompt-text-action');
            if(promptText) {
                if (pendingBaseItem.type === 'currency') promptText.innerText = "COLLECT CURRENCY?";
                else if (pendingBaseItem.type === 'lucky') promptText.innerText = "COLLECT TICKET?";
                else if (pendingBaseItem.type === 'timeBonus') promptText.innerText = "COLLECT BOOST?";
                else if (pendingBaseItem.type === 'guaranteed') promptText.innerText = "COLLECT SPECIAL?";
                else promptText.innerText = "ADD TO BASE?";
            }
            const confirmBtn = document.getElementById('prompt-confirm-btn');
            if (confirmBtn) {
                const currencyIcon = pendingBaseItem.currency === 'gold' ? GOLD_ICON_HTML : (pendingBaseItem.currency === 'moonstones' ? MOONSTONE_ICON_HTML : SILVER_ICON_HTML);
                const btnColor = pendingBaseItem.currency === 'gold' ? 'bg-yellow-600 hover:bg-yellow-500' : (pendingBaseItem.currency === 'moonstones' ? 'bg-purple-600 hover:bg-purple-500' : 'bg-green-500 hover:bg-green-600');
                confirmBtn.innerHTML = `BUY (-${formatNumber(pendingBaseItem.cost)} ${currencyIcon})`;
                confirmBtn.className = `py-3 ${btnColor} text-white font-black uppercase rounded transition-colors flex items-center justify-center gap-1`;
            }
            m.classList.remove('hidden');
            setTimeout(() => { c.classList.remove('scale-95', 'opacity-0'); c.classList.add('scale-100', 'opacity-100'); }, 10);
        }

        function closeBasePrompt() {
            const m = document.getElementById('base-prompt-modal'), c = document.getElementById('base-prompt-content');
            c.classList.add('scale-95', 'opacity-0');
            setTimeout(() => { m.classList.add('hidden'); pendingBaseItem = null; pendingItemUniqueId = null; }, 300);
        }

        function confirmBaseAdd() {
            if(!pendingBaseItem) return;
            const cost = pendingBaseItem.cost;
            const currencyType = pendingBaseItem.currency || 'silver';
            if (currencies[currencyType] < cost) {
                closeBasePrompt();
                return;
            }
            currencies[currencyType] -= cost;
            playSound('buy'); 
            if (pendingBaseItem.type === 'currency') {
                if (pendingBaseItem.currencyType) currencies[pendingBaseItem.currencyType] += (pendingBaseItem.value || 1);
                playSound('ching');
            } 
            else if (pendingBaseItem.type === 'lucky') { 
                if (pendingBaseItem.luckyType) {
                    inventory[pendingBaseItem.luckyType]++; 
                    if (pendingBaseItem.luckyType === 'lucky') addPowerCrystals(1);
                    else if (pendingBaseItem.luckyType === 'grand') addPowerCrystals(2);
                    else if (pendingBaseItem.luckyType === 'crazy') addPowerCrystals(5);
                    playSound('laser'); 
                }
            }
            else if (pendingBaseItem.type === 'timeBonus') { if (pendingBaseItem.bonusType) inventory.timeBonus[pendingBaseItem.bonusType]++; playSound('laser'); }
            else if (pendingBaseItem.type === 'guaranteed') { if (pendingBaseItem.specialType) inventory.special[pendingBaseItem.specialType]++; playSound('heaven'); }
            else {
                const emptyIdx = baseInventory.indexOf(null);
                const maxSlots = getMaxBaseSlots();
                if(emptyIdx === -1 || emptyIdx >= maxSlots) { 
                    currencies[currencyType] += cost; 
                    closeBasePrompt(); 
                    return; 
                }
                baseInventory[emptyIdx] = pendingBaseItem; playSound('heaven');
                handleCollection(pendingBaseItem); 
            }
            if (pendingItemUniqueId) {
                const elements = document.querySelectorAll(`[data-unique-id="${pendingItemUniqueId}"]`);
                elements.forEach(el => el.remove());
                const history = document.getElementById('rot-history');
                if (history && history.children.length === 0) history.innerHTML = '<div id="carpet-placeholder" class="text-white/30 font-black brand-font uppercase text-xs tracking-widest w-full text-center">Draw to Walk the Red Carpet</div>';
            }
            updateStatsUI(); saveGame(); closeBasePrompt();
        }

        function renderInventory(id, count, icon, type) {
            const container = document.getElementById(id); if(!container) return;
            container.innerHTML = '';
            for(let i=0; i<3; i++) {
                const slot = document.createElement('div');
                slot.className = `w-12 h-12 bg-black border-2 rounded-lg flex items-center justify-center text-2xl inv-slot ${i < count ? 'active' : 'empty'}`;
                slot.style.borderColor = (type === 'lucky') ? '#EAB308' : (type === 'grand' ? '#06B6D4' : '#A855F7');
                slot.innerHTML = icon;
                if(i < count) slot.onclick = () => activateRot(type);
                container.appendChild(slot);
            }
        }

        function toggleLiveRoll() {
            if (isAutoFestivalActive || isAutoRainbowActive) return;
            const btn = document.getElementById('live-roll-btn');
            if (liveRollInterval) {
                clearInterval(liveRollInterval); liveRollInterval = null; audioLib.ambience.pause(); audioLib.ambience.currentTime = 0;
                if(btn) { btn.innerHTML = '<i data-lucide="play" class="w-3 h-3"></i> AUTO'; btn.classList.remove('bg-red-600', 'hover:bg-red-500'); btn.classList.add('bg-green-600', 'hover:bg-green-500'); lucide.createIcons(); }
            } else {
                playSound('ambience'); pullRot(true, 1, 1, true); 
                liveRollInterval = setInterval(() => { pullRot(true, 1, 1, true); }, 3000); 
                if(btn) { btn.innerHTML = '<div id="live-indicator" class="w-2 h-2 bg-white rounded-full animate-pulse"></div> STOP AUTO'; btn.classList.remove('bg-green-600', 'hover:bg-green-500'); btn.classList.add('bg-red-600', 'hover:bg-red-500'); }
            }
        }

        function triggerCameraFlash() {
            const carpet = document.getElementById('rot-history'); if(!carpet) return;
            const count = 2 + Math.floor(Math.random() * 3);
            for(let i=0; i<count; i++) {
                setTimeout(() => {
                    const flash = document.createElement('div');
                    flash.className = 'absolute w-12 h-12 bg-white rounded-full blur-xl z-50 pointer-events-none animate-flash-burst mix-blend-overlay';
                    flash.style.left = Math.random() * 80 + '%'; flash.style.top = Math.random() * 60 + 10 + '%';
                    carpet.appendChild(flash); setTimeout(() => flash.remove(), 200);
                }, i * 50);
            }
            if(Math.random() > 0.7) {
                const screenFlash = document.createElement('div');
                screenFlash.className = 'absolute inset-0 bg-white/20 pointer-events-none z-40 transition-opacity duration-100';
                carpet.appendChild(screenFlash); 
                setTimeout(() => { if(screenFlash.parentNode) screenFlash.style.opacity = '0'; }, 50); 
                setTimeout(() => { if(screenFlash.parentNode) screenFlash.remove(); }, 150);
            }
        }

        window.pullRot = function(isAutoRoll = false, drawCount = 1, luckMultiplier = 1, isInstant = false) {
            const content = document.getElementById('rot-content'); const history = document.getElementById('rot-history'); const btn = document.getElementById('pull-btn');
            if(isAutoFestivalActive || isAutoRainbowActive) { if(!isAutoRoll && !isInstant) return; }
            if(btn && btn.disabled && !isAutoRoll && !isInstant) return;
            if(!isInstant && btn) btn.disabled = true;
            if(!isInstant && content) content.innerHTML = `<div class="text-7xl animate-spin">üåÄ</div>`;
            if(!isInstant) playSound('draw');
            currencies.silver += 1; 
            if(!isInstant) showFloatingText(`+1 ${SILVER_ICON_HTML}`, window.innerWidth / 2, window.innerHeight / 2, "#9CA3AF");
            updateStatsUI();
            const delay = isInstant ? 0 : 1000;
            setTimeout(() => {
                let results = [];
                for(let d=0; d<drawCount; d++) {
                    const crystalRoll = Math.random() * 100;
                    if (crystalRoll < 0.0001) addPowerCrystals(20);
                    else if (crystalRoll < 0.0005) addPowerCrystals(15);
                    else if (crystalRoll < 0.001) addPowerCrystals(10);
                    else if (crystalRoll < 0.005) addPowerCrystals(5);
                    let selectedTier = tierConfig[tierConfig.length - 1];
                    if (forcedTierId) { selectedTier = tierConfig.find(t => t.id === forcedTierId); forcedTierId = null; } 
                    else {
                        const sRoll = Math.random() * 100;
                        if (sRoll < 0.001) selectedTier = { id: 'TIER_MOONSTONE', name: 'MOONSTONE', stars: 10, borderColor: '#7C3AED', textColor: '#D8B4FE' };
                        else if (sRoll < 0.01) selectedTier = { id: 'CURRENCY_TIER', name: 'DIAMOND', stars: 9, borderColor: '#60A5FA', textColor: '#93C5FD' };
                        else if (sRoll < 0.05) selectedTier = { id: 'CURRENCY_TIER', name: 'GOLD 10', stars: 8, borderColor: '#FBBF24', textColor: '#FDE68A' };
                        else if (sRoll < 0.1) selectedTier = { id: 'CURRENCY_TIER', name: 'GOLD 5', stars: 7, borderColor: '#FBBF24', textColor: '#FDE68A' };
                        else if (sRoll < 0.2) selectedTier = { id: 'CURRENCY_TIER', name: 'GOLD 2', stars: 6, borderColor: '#FBBF24', textColor: '#FDE68A' };
                        else if (sRoll < 1.0) selectedTier = { id: 'CURRENCY_TIER', name: 'GOLD 1', stars: 5, borderColor: '#FBBF24', textColor: '#FDE68A' };
                        else {
                            let totalChance = 0;
                            const totalLuckFactor = (currentMultiplier + bonusBaseLuck + (isAutoFestivalActive || isAutoRainbowActive ? 1 : 0)) * luckMultiplier;
                            for(let i=0; i<tierConfig.length; i++) {
                                let chance = tierConfig[i].probability * totalLuckFactor;
                                if (activeTimeBonus.endTime > Date.now()) { chance *= activeTimeBonus.value; }
                                totalChance += chance;
                            }
                            const tRoll = Math.random() * totalChance;
                            let curT = 0;
                            for(let i=0; i<tierConfig.length; i++) {
                                let chance = tierConfig[i].probability * totalLuckFactor;
                                if (activeTimeBonus.endTime > Date.now()) { chance *= activeTimeBonus.value; }
                                curT += chance; if(tRoll < curT) { selectedTier = tierConfig[i]; break; }
                            }
                        }
                    }
                    let items = itemDatabase[selectedTier.id] || itemDatabase['COMMON'];
                    const item = items[Math.floor(Math.random() * items.length)];
                    const uniqueId = 'item-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
                    results.push({ item: item, tier: selectedTier, uniqueId: uniqueId });
                }
                if(content) {
                    content.innerHTML = '';
                    results.forEach(r => {
                        const screenDiv = document.createElement('div');
                        screenDiv.className = "inline-flex flex-col items-center mx-2 cursor-pointer hover:scale-105 active:scale-95 transition-transform relative z-10 p-2 rounded-2xl bg-white/5 border border-white/10";
                        screenDiv.setAttribute('data-unique-id', r.uniqueId); 
                        const cost = r.item.cost || 1, currency = r.item.currency || 'silver';
                        const isSpecialType = ['lucky', 'timeBonus', 'guaranteed', 'currency'].includes(r.item.type);
                        const isFree = (cost <= 1 && currency === 'silver') || isSpecialType;
                        const currencyIcon = currency === 'gold' ? GOLD_ICON_HTML : (currency === 'moonstones' ? MOONSTONE_ICON_HTML : SILVER_ICON_HTML); 
                        const priceColor = currency === 'gold' ? 'text-yellow-400' : (currency === 'moonstones' ? 'text-purple-400' : 'text-gray-300');
                        let priceDisplay = `${formatNumber(cost)} ${currencyIcon}`; 
                        if (isFree) priceDisplay = "<span class='text-green-400'>FREE</span>";
                        const stars = getStarHTML(r.tier.stars || 1, 'draw-stars');
                        screenDiv.innerHTML = `<div class="w-24 h-24 md:w-32 md:h-32 flex items-center justify-center animate-pop mb-2 relative"><div class="absolute inset-0 rounded-xl border-2 opacity-50" style="border-color:${r.tier.borderColor}"></div><div class="w-full h-full p-1 flex items-center justify-center text-5xl md:text-7xl overflow-hidden">${r.item.icon}</div>${stars}</div><div class="text-xs md:text-sm font-black uppercase tracking-tight leading-tight max-w-[100px] md:max-w-[120px] truncate" style="color:${r.tier.textColor}">${r.item.name}</div><div class="mt-1 px-2 py-0.5 rounded bg-black/60 border border-white/10"><div class="text-[10px] md:text-xs font-black ${priceColor} flex items-center justify-center gap-0.5">${priceDisplay}</div></div>`;
                        if (isFree) { screenDiv.onclick = (e) => { e.stopPropagation(); collectFreeItem(r.item, r.tier, r.uniqueId); }; }
                        else { screenDiv.onclick = (e) => { e.stopPropagation(); promptAddToBase(r.item, r.tier, r.uniqueId); }; }
                        content.appendChild(screenDiv);
                    });
                }
                results.forEach(res => {
                    if (res.item.name === "Cowgirl Rush") { triggerCowgirlRush(); return; }
                    const hItem = document.createElement('div');
                    hItem.className = 'w-12 h-14 rounded carpet-item-box flex flex-col items-center justify-center border-2 overflow-hidden bg-black flex-shrink-0 relative'; 
                    hItem.setAttribute('data-unique-id', res.uniqueId); 
                    const cost = res.item.cost || 1, currency = res.item.currency || 'silver';
                    const isSpecialType = ['lucky', 'timeBonus', 'guaranteed', 'currency'].includes(res.item.type);
                    const isFree = (cost <= 1 && currency === 'silver') || isSpecialType;
                    const currencyIcon = res.item.currency === 'gold' ? GOLD_ICON_HTML : (res.item.currency === 'moonstones' ? MOONSTONE_ICON_HTML : SILVER_ICON_HTML); 
                    const priceColor = res.item.currency === 'gold' ? 'text-yellow-400' : (res.item.currency === 'moonstones' ? 'text-purple-400' : 'text-gray-300');
                    let priceDisplay = `${formatNumber(cost)} ${currencyIcon}`; 
                    if (isFree) priceDisplay = "<span class='text-green-400'>FREE</span>";
                    const stars = getStarHTML(res.tier.stars || 1, 'carpet-stars');
                    hItem.innerHTML = `<div class="text-2xl relative w-full h-full flex items-center justify-center">${res.item.icon}${stars}</div><div class="text-[8px] font-black ${priceColor} leading-none mb-1 flex items-center gap-0.5 z-20 bg-black/50 px-1 rounded">${priceDisplay}</div>`;
                    hItem.style.borderColor = res.tier.borderColor;
                    if (isFree) { hItem.onclick = () => collectFreeItem(res.item, res.tier, res.uniqueId); }
                    else { hItem.onclick = () => promptAddToBase(res.item, res.tier, res.uniqueId); }
                    const placeholder = document.getElementById('carpet-placeholder'); if(placeholder) history.innerHTML = '';
                    history.prepend(hItem); if(isInstant) triggerCameraFlash();
                    requestAnimationFrame(() => {
                        const historyRect = history.getBoundingClientRect(); 
                        const children = Array.from(history.children);
                        children.forEach(child => { const childRect = child.getBoundingClientRect(); if (childRect.left > historyRect.right) child.remove(); });
                        while(history.children.length > 25) history.removeChild(history.lastChild);
                    });
                });
                if(btn && !isInstant) { 
                    const span = btn.querySelector('span');
                    if (isAutoRainbowActive) { btn.disabled = true; if (span) span.innerText = "RAINBOW MODE ACTIVE"; } 
                    else if (isAutoFestivalActive) { btn.disabled = true; if (span) span.innerText = "LANTERN FESTIVAL ACTIVE"; } 
                    else { btn.disabled = false; if (span) span.innerText = "DRAW AGAIN"; }
                }
                if (isInstant) { playSound('shutter'); if(results.some(r => (r.tier.stars || 1) >= 7)) setTimeout(() => playSound('wow'), 200); }
                else { playSound('pop'); }
                saveGame();
            }, delay);
        };

        function showFloatingText(text, x, y, color = "#FFF") {
            const el = document.createElement('div');
            el.className = 'currency-pop-text brand-font font-black pointer-events-none flex items-center gap-1';
            el.style.left = x + 'px'; el.style.top = y + 'px'; el.style.color = color; el.innerHTML = text;
            document.body.appendChild(el); setTimeout(() => el.remove(), 1400);
        }

        function collectFreeItem(item, tier, uniqueId) {
            const itemData = { ...item, tierColor: tier.borderColor, tierName: tier.name, tierId: tier.id, cost: 0, currency: item.currency || 'silver', sell: item.sell || 1, income: item.income || 1, goldIncome: item.goldIncome || 0, type: item.type || 'character' };
            const elements = document.querySelectorAll(`[data-unique-id="${uniqueId}"]`), rect = elements[0] ? elements[0].getBoundingClientRect() : { left: window.innerWidth/2, top: window.innerHeight/2 };
            elements.forEach(el => el.classList.add('animate-collect-zoom'));
            let success = true;
            if (itemData.type === 'currency') { 
                if (itemData.currencyType) { currencies[itemData.currencyType] += (itemData.value || 1); let icon = itemData.currencyType === 'gold' ? GOLD_ICON_HTML : (itemData.currencyType === 'silver' ? SILVER_ICON_HTML : (itemData.currencyType === 'moonstones' ? MOONSTONE_ICON_HTML : (itemData.currencyType === 'stars' ? 'üåü' : 'üíé'))); showFloatingText(`+${formatNumber(itemData.value || 1)} ${icon}`, rect.left, rect.top, "#FFD700"); }
                playSound('ching'); 
            } 
            else if (itemData.type === 'lucky') { 
                if (itemData.luckyType) { inventory[itemData.luckyType]++; if (itemData.luckyType === 'lucky') addPowerCrystals(1, rect.left, rect.top); else if (itemData.luckyType === 'grand') addPowerCrystals(2, rect.left, rect.top); else if (itemData.luckyType === 'crazy') addPowerCrystals(5, rect.left, rect.top); playSound('laser'); }
            }
            else if (itemData.type === 'timeBonus') { if (itemData.bonusType) inventory.timeBonus[itemData.bonusType]++; playSound('laser'); }
            else if (itemData.type === 'guaranteed') { if (itemData.specialType) inventory.special[itemData.specialType]++; playSound('heaven'); }
            else {
                const emptyIdx = baseInventory.indexOf(null), maxSlots = getMaxBaseSlots();
                if(emptyIdx === -1 || emptyIdx >= maxSlots) { elements.forEach(el => el.classList.remove('animate-collect-zoom')); success = false; }
                else { baseInventory[emptyIdx] = itemData; playSound('heaven'); handleCollection(itemData); }
            }
            if (success) { updateStatsUI(); saveGame(); setTimeout(() => { elements.forEach(el => el.remove()); const history = document.getElementById('rot-history'); if (history && history.children.length === 0) history.innerHTML = '<div id="carpet-placeholder" class="text-white/30 font-black brand-font uppercase text-xs tracking-widest w-full text-center">Draw to Walk the Red Carpet</div>'; }, 300); }
        }

        function purchaseItem(cat, type, curr, cost) { if(currencies[curr] >= cost) { currencies[curr] -= cost; if(cat === 'lucky') inventory[type]++; if(cat === 'time') inventory.timeBonus[type]++; if(cat === 'special') inventory.special[type]++; playSound('buy'); updateStatsUI(); saveGame(); } }
        function handleCollection(itemData) { if(!collectedItemsMap[itemData.name]) { collectedItemsMap[itemData.name] = true; initCollection(); checkTierCompletions(); if (['BRAINROT_GOD', 'SECRET', 'GOAT'].includes(itemData.tierId)) { showGlobalBroadcast(itemData.name, itemData.tierColor); } } }
        function checkTierCompletions() { Object.keys(MAXXER_REWARDS).forEach(rarity => { if (rewards[rarity]) return; const tierItems = itemDatabase[rarity]; if (!tierItems) return; if (tierItems.every(it => collectedItemsMap[it.name] === true)) { awardMaxxer(rarity); } }); }
        function awardMaxxer(rarity) { rewards[rarity] = true; const data = MAXXER_REWARDS[rarity]; const modal = document.getElementById('reward-modal'), content = document.getElementById('reward-content'); document.getElementById('reward-rarity-text').innerText = `ALL ${rarity.replace('_', ' ')} BRAINROT COLLECTED!`; document.getElementById('reward-item-icon').innerText = data.icon; document.getElementById('reward-item-name').innerText = data.name.toUpperCase(); modal.classList.remove('hidden'); setTimeout(() => { content.classList.remove('scale-95', 'opacity-0'); content.classList.add('scale-100', 'opacity-100'); }, 10); playSound('heaven'); updateStatsUI(); saveGame(); }
        function closeRewardModal() { const m = document.getElementById('reward-modal'), c = document.getElementById('reward-content'); c.classList.add('scale-95', 'opacity-0'); setTimeout(() => { m.classList.add('hidden'); }, 500); }
        function showCollectionLore(tierId, itemName) { const tier = tierConfig.find(t => t.id === tierId), item = itemDatabase[tierId].find(i => i.name === itemName); if(item && tier) showLoreModal(item, tier); }
        function initCollection() { const grid = document.getElementById('collection-grid'); if(!grid) return; grid.innerHTML = ''; tierConfig.slice().reverse().forEach(tier => { if (!['COMMON', 'RARE', 'EPIC', 'LEGENDARY', 'MYTHIC', 'BRAINROT_GOD', 'SECRET', 'GOAT'].includes(tier.id)) return; const sec = document.createElement('div'); sec.className = `rounded-xl border-2 p-4 mb-4 ${tier.bg || 'bg-gray-900/40'}`; sec.style.borderColor = tier.borderColor; const items = itemDatabase[tier.id] || []; const itemsHtml = items.map(it => { const isCollected = collectedItemsMap[it.name] === true, safeName = it.name.replace(/'/g, "\\'"), stars = getStarHTML(tier.stars || 1, 'collection-stars'); return `<div onclick="${isCollected ? `showCollectionLore('${tier.id}', '${safeName}')` : ''}" class="w-10 h-10 rounded bg-black flex items-center justify-center text-xl cursor-pointer transition-transform hover:scale-110 active:scale-95 relative ${isCollected ? '' : 'opacity-20 grayscale'}">${isCollected ? it.icon : '‚ùì'}${isCollected ? stars : ''}</div>`; }).join(''); sec.innerHTML = `<h4 class="font-black mb-2" style="color:${tier.textColor}">${tier.name}</h4><div class="flex flex-wrap gap-2">${itemsHtml}</div>`; grid.appendChild(sec); }); }
        function saveGame() { localStorage.setItem('brainrotCollectorV6', JSON.stringify({ collectedItems: collectedItemsMap, inventory, currencies, rewards, base: baseInventory, accumulatedSilver, accumulatedGold })); }
        function loadGame() { const data = localStorage.getItem('brainrotCollectorV6'); if(data) { const s = JSON.parse(data); collectedItemsMap = s.collectedItems || {}; inventory = s.inventory || inventory; if (!inventory.upgrades) inventory.upgrades = { expander1: false, expander2: false }; currencies = s.currencies || currencies; if (currencies.powerCrystals === undefined) currencies.powerCrystals = 0; baseInventory = s.base || baseInventory; const maxSlots = getMaxBaseSlots(); while(baseInventory.length < maxSlots) baseInventory.push(null); rewards = s.rewards || {}; accumulatedSilver = s.accumulatedSilver || 0; accumulatedGold = s.accumulatedGold || 0; } else { currencies.silver = 10; currencies.powerCrystals = 0; } initCollection(); updateStatsUI(); }
        function resetGame() { baseInventory = new Array(15).fill(null); currencies = { stars: 0, diamonds: 0, moonstones: 0, gold: 0, silver: 10, powerCrystals: 0 }; collectedItemsMap = {}; inventory = { lucky: 0, grand: 0, crazy: 0, special: { god: 0, secret: 0, goat: 0, ultimate: 0, admin: 0 }, timeBonus: { x2: 0, x4: 0, x10: 0, x20: 0 }, upgrades: { expander1: false, expander2: false } }; rewards = {}; localStorage.removeItem('brainrotCollectorV6'); location.reload(); }
        function activateDevMode() { currencies = { stars: 100, diamonds: 100, moonstones: 100, gold: 1000, silver: 50000000000000, powerCrystals: 100 }; showFloatingText(`+DEV BOOSTER ACTIVE`, window.innerWidth/2, window.innerHeight/2, "#39ff14"); updateStatsUI(); saveGame(); }
        function showLoreModal(item, tier, inventoryIndex = -1) { const m = document.getElementById('lore-modal'), c = document.getElementById('lore-content'); document.getElementById('lore-icon').innerHTML = `<div class="relative inline-block">${item.icon}${getStarHTML(tier.stars || 1, 'draw-stars')}</div>`; document.getElementById('lore-name').innerText = item.name; document.getElementById('lore-rarity').innerText = tier.name; document.getElementById('lore-text').innerText = item.description || "[DATA CORRUPTED]"; const buyCurrencyIcon = item.currency === 'gold' ? GOLD_ICON_HTML : (item.currency === 'moonstones' ? MOONSTONE_ICON_HTML : SILVER_ICON_HTML); document.getElementById('lore-buy-val').innerHTML = `${formatNumber(item.cost || 1)} ${buyCurrencyIcon}`; const sellCurrencyIcon = item.currency === 'gold' ? GOLD_ICON_HTML : SILVER_ICON_HTML; document.getElementById('lore-sell-val').innerHTML = `${formatNumber(item.sell || 1)} ${sellCurrencyIcon}`; let incomeHtml = `${formatNumber(item.income || 0)} ${SILVER_ICON_HTML}`; if (item.goldIncome > 0) incomeHtml += `<br>${formatNumber(item.goldIncome)} ${GOLD_ICON_HTML}`; document.getElementById('lore-income-val').innerHTML = incomeHtml; const btnContainer = document.getElementById('sell-btn-container'); if (inventoryIndex > -1) { const sellValue = formatNumber(item.sell || 1); btnContainer.innerHTML = `<button onclick="sellItem(${inventoryIndex})" class="w-full py-3 bg-red-600 text-white font-black uppercase rounded hover:bg-red-500 shadow-[0_0_15px_rgba(220,38,38,0.5)] flex items-center justify-center gap-1">SELL (+${sellValue} ${item.currency === 'gold' ? GOLD_ICON_HTML : SILVER_ICON_HTML})</button>`; } else { btnContainer.innerHTML = ''; } m.classList.remove('hidden'); setTimeout(() => { c.classList.remove('scale-95', 'opacity-0'); c.classList.add('scale-100', 'opacity-100'); }, 10); }
        function closeLoreModal() { const m = document.getElementById('lore-modal'), c = document.getElementById('lore-content'); c.classList.add('scale-95', 'opacity-0'); setTimeout(() => { m.classList.add('hidden'); }, 300); }
        function sellItem(index) { const item = baseInventory[index]; if (item) { const currency = item.currency || 'silver', value = item.sell || 1, icon = currency === 'gold' ? GOLD_ICON_HTML : (currency === 'moonstones' ? MOONSTONE_ICON_HTML : SILVER_ICON_HTML); baseInventory[index] = null; currencies[currency] += value; showFloatingText(`+${formatNumber(value)} ${icon}`, window.innerWidth / 2, window.innerHeight / 2, currency === 'gold' ? '#FBBF24' : (currency === 'moonstones' ? '#A855F7' : '#9CA3AF')); playSound('sell'); updateStatsUI(); saveGame(); closeLoreModal(); } }
        function collectIncome() { let collected = false; const collectBtn = document.getElementById('global-collect-btn'), rect = collectBtn.getBoundingClientRect(); if (accumulatedSilver > 0) { currencies.silver += accumulatedSilver; showFloatingText(`+${formatNumber(accumulatedSilver)} ${SILVER_ICON_HTML}`, rect.left, rect.top, "#9CA3AF"); accumulatedSilver = 0; collected = true; } if (accumulatedGold > 0) { currencies.gold += accumulatedGold; showFloatingText(`+${formatNumber(accumulatedGold)} ${GOLD_ICON_HTML}`, rect.left, rect.top + 20, "#FBBF24"); accumulatedGold = 0; collected = true; } if (collected) { playSound('ching'); updateStatsUI(); saveGame(); } }
        function sortBase() { const items = baseInventory.filter(i => i !== null); items.sort((a, b) => (b.income || 0) - (a.income || 0)); const maxSlots = getMaxBaseSlots(), newBase = new Array(maxSlots).fill(null); items.forEach((item, index) => { if(index < maxSlots) newBase[index] = item; }); baseInventory = newBase; renderBaseUI(); saveGame(); playSound('pop'); }
        window.activateRot = function(type) { if (inventory[type] > 0) { if (!document.getElementById('inventory-menu').classList.contains('hidden')) toggleInventory(); inventory[type]--; const playSection = document.getElementById('play'); if (playSection) playSection.scrollIntoView({ behavior: 'smooth' }); playSound('rolling'); let luck = (type === 'lucky') ? 10 : (type === 'grand' ? 20 : 40); window.pullRot(true, (type === 'crazy' ? 3 : (type === 'grand' ? 2 : 1)), luck); updateStatsUI(); } };
        window.activateTimeBonus = function(mult) { if (inventory.timeBonus[`x${mult}`] > 0) { if (!document.getElementById('inventory-menu').classList.contains('hidden')) toggleInventory(); inventory.timeBonus[`x${mult}`]--; applyLuckBonus(mult, 60000); playSound('laser'); updateStatsUI(); } };
        function applyLuckBonus(mult, duration) { activeTimeBonus = { value: mult, endTime: Date.now() + duration }; const badge = document.getElementById('multiplier-badge'), badgeText = document.getElementById('multiplier-text'); if (mult > 1) { playSound('thunder'); badge.classList.remove('hidden', 'animate-luck-pop'); void badge.offsetWidth; badge.classList.add('animate-luck-pop'); badgeText.innerText = `LUCK x${mult} ACTIVE!`; } else { badge.classList.add('hidden'); } if (duration > 0) { setTimeout(() => { if (Date.now() >= activeTimeBonus.endTime) { activeTimeBonus = { value: 1, endTime: 0 }; badge.classList.add('hidden'); } }, duration); } }
        function triggerCowgirlRush() { const rushModal = document.createElement('div'); rushModal.className = 'fixed inset-0 z-[200] flex items-center justify-center pointer-events-none'; rushModal.innerHTML = `<div class="animate-bounce text-9xl relative z-10 filter drop-shadow-[0_0_20px_#EC4899]">ü§†</div><div class="absolute inset-0 bg-pink-500/20 animate-pulse mix-blend-overlay"></div><h1 class="absolute mt-40 text-white font-black text-6xl md:text-8xl drop-shadow-[0_0_20px_#EC4899] animate-ping whitespace-nowrap">COWGIRL RUSH!</h1>`; document.body.appendChild(rushModal); playSound('heaven'); addPowerCrystals(5); applyLuckBonus(2, 30000); setTimeout(() => { rushModal.remove(); }, 3000); }
        window.activateSpecial = function(type) { if (inventory.special[type] > 0) { if (!document.getElementById('inventory-menu').classList.contains('hidden')) toggleInventory(); inventory.special[type]--; forcedTierId = (type === 'god') ? 'BRAINROT_GOD' : (type === 'secret' ? 'SECRET' : 'GOAT'); playSound('heaven'); document.getElementById('rot-content').innerHTML = `<div class="text-4xl animate-pulse text-yellow-400 font-bold">NEXT DRAW GUARANTEED!</div>`; updateStatsUI(); } };
        function updateTimers() { const now = new Date(), hour = now.getHours(), min = now.getMinutes(), sec = now.getSeconds(), festivalCountdownEl = document.getElementById('festival-countdown'), rainbowCountdownEl = document.getElementById('rainbow-countdown'); if (Date.now() - lastFiveMinuteAward >= 300000) { addPowerCrystals(5); lastFiveMinuteAward = Date.now(); } const isFestivalTime = (hour % 2 === 0 && min < 5); if (isFestivalTime) { if (!isAutoFestivalActive) { isAutoFestivalActive = true; playSound('thunder'); if (audioLib.elevator.paused) toggleMusic(); } const remMin = 4 - min, remSec = 59 - sec; festivalCountdownEl.innerText = `ENDS: ${String(remMin).padStart(2, '0')}:${String(remSec).padStart(2, '0')}`; festivalCountdownEl.classList.add('text-pink-500', 'animate-pulse'); } else { if (isAutoFestivalActive) { isAutoFestivalActive = false; if (!audioLib.elevator.paused) toggleMusic(); } let nextHour = (hour % 2 !== 0) ? hour + 1 : (min >= 5 ? hour + 2 : hour); if (nextHour >= 24) nextHour = 0; const nextDate = new Date(); nextDate.setHours(nextHour, 0, 0, 0); if (nextHour <= hour && min >= 5) nextDate.setDate(nextDate.getDate() + 1); const diff = nextDate - now, h = Math.floor(diff / 3600000), m = Math.floor((diff % 3600000) / 60000), s = Math.floor((diff % 60000) / 1000); festivalCountdownEl.innerText = `NEXT: ${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')}`; festivalCountdownEl.classList.remove('text-pink-500', 'animate-pulse'); } const isRainbowTime = (hour % 2 !== 0 && min < 5); if (isRainbowTime) { if (!isAutoRainbowActive) { isAutoRainbowActive = true; playSound('thunder'); if (audioLib.disco.paused) toggleDisco(); } const remMin = 4 - min, remSec = 59 - sec; rainbowCountdownEl.innerText = `ENDS: ${String(remMin).padStart(2, '0')}:${String(remSec).padStart(2, '0')}`; rainbowCountdownEl.classList.add('text-white', 'animate-pulse'); } else { if (isAutoRainbowActive) { isAutoRainbowActive = false; if (!audioLib.disco.paused) toggleDisco(); } let nextHour = (hour % 2 === 0) ? hour + 1 : (min >= 5 ? hour + 2 : hour); if (nextHour >= 24) nextHour = 1; const nextDate = new Date(); nextDate.setHours(nextHour, 0, 0, 0); if (nextHour <= hour && min >= 5) nextDate.setDate(nextDate.getDate() + 1); const diff = nextDate - now, h = Math.floor(diff / 3600000), m = Math.floor((diff % 3600000) / 60000), s = Math.floor((diff % 60000) / 1000); rainbowCountdownEl.innerText = `NEXT: ${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')}`; rainbowCountdownEl.classList.remove('text-white', 'animate-pulse'); } }
        setInterval(() => { let silverInc = 0, goldInc = 0; baseInventory.forEach(item => { if (item) { silverInc += (item.income || 0); goldInc += (item.goldIncome || 0); } }); if (silverInc > 0 || goldInc > 0) { accumulatedSilver += silverInc; accumulatedGold += goldInc; updateStatsUI(); saveGame(); } updateTimers(); }, 1000);
        function initSakura() { const container = document.getElementById('sakura-container'); if(!container) return; setInterval(() => { const petal = document.createElement('div'); petal.innerText = 'üå∏'; petal.className = 'sakura-petal text-pink-300/80 drop-shadow-lg'; const size = Math.random() * 15 + 10, left = Math.random() * 100, duration = Math.random() * 5 + 5; petal.style.fontSize = `${size}px`; petal.style.left = `${left}%`; petal.style.animationDuration = `${duration}s`; container.appendChild(petal); setTimeout(() => { petal.remove(); }, duration * 1000); }, 400); }
        document.addEventListener('DOMContentLoaded', () => { loadGame(); initSakura(); updateTimers(); setTimeout(() => { if (!liveRollInterval) toggleLiveRoll(); }, 500); });
    </script>
</body>
</html>